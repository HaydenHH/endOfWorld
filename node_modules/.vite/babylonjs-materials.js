import {
  __commonJS,
  require_babylon
} from "./chunk-C2S6M2XJ.js";

// node_modules/babylonjs-materials/babylonjs.materials.min.js
var require_babylonjs_materials_min = __commonJS({
  "node_modules/babylonjs-materials/babylonjs.materials.min.js"(exports, module) {
    !function(e, t) {
      typeof exports == "object" && typeof module == "object" ? module.exports = t(require_babylon()) : typeof define == "function" && define.amd ? define("babylonjs-materials", ["babylonjs"], t) : typeof exports == "object" ? exports["babylonjs-materials"] = t(require_babylon()) : e.MATERIALS = t(e.BABYLON);
    }(typeof self != "undefined" ? self : typeof global != "undefined" ? global : exports, function(e) {
      return function(e2) {
        var t = {};
        function i(n) {
          if (t[n])
            return t[n].exports;
          var r = t[n] = { i: n, l: false, exports: {} };
          return e2[n].call(r.exports, r, r.exports, i), r.l = true, r.exports;
        }
        return i.m = e2, i.c = t, i.d = function(e3, t2, n) {
          i.o(e3, t2) || Object.defineProperty(e3, t2, { enumerable: true, get: n });
        }, i.r = function(e3) {
          typeof Symbol != "undefined" && Symbol.toStringTag && Object.defineProperty(e3, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(e3, "__esModule", { value: true });
        }, i.t = function(e3, t2) {
          if (1 & t2 && (e3 = i(e3)), 8 & t2)
            return e3;
          if (4 & t2 && typeof e3 == "object" && e3 && e3.__esModule)
            return e3;
          var n = Object.create(null);
          if (i.r(n), Object.defineProperty(n, "default", { enumerable: true, value: e3 }), 2 & t2 && typeof e3 != "string")
            for (var r in e3)
              i.d(n, r, function(t3) {
                return e3[t3];
              }.bind(null, r));
          return n;
        }, i.n = function(e3) {
          var t2 = e3 && e3.__esModule ? function() {
            return e3.default;
          } : function() {
            return e3;
          };
          return i.d(t2, "a", t2), t2;
        }, i.o = function(e3, t2) {
          return Object.prototype.hasOwnProperty.call(e3, t2);
        }, i.p = "", i(i.s = 19);
      }([function(t, i) {
        t.exports = e;
      }, function(e2, t, i) {
        "use strict";
        i.d(t, "b", function() {
          return r;
        }), i.d(t, "a", function() {
          return o;
        });
        var n = function(e3, t2) {
          return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(e4, t3) {
            e4.__proto__ = t3;
          } || function(e4, t3) {
            for (var i2 in t3)
              Object.prototype.hasOwnProperty.call(t3, i2) && (e4[i2] = t3[i2]);
          })(e3, t2);
        };
        function r(e3, t2) {
          if (typeof t2 != "function" && t2 !== null)
            throw new TypeError("Class extends value " + String(t2) + " is not a constructor or null");
          function i2() {
            this.constructor = e3;
          }
          n(e3, t2), e3.prototype = t2 === null ? Object.create(t2) : (i2.prototype = t2.prototype, new i2());
        }
        function o(e3, t2, i2, n2) {
          var r2, o2 = arguments.length, a = o2 < 3 ? t2 : n2 === null ? n2 = Object.getOwnPropertyDescriptor(t2, i2) : n2;
          if (typeof Reflect == "object" && typeof Reflect.decorate == "function")
            a = Reflect.decorate(e3, t2, i2, n2);
          else
            for (var s = e3.length - 1; s >= 0; s--)
              (r2 = e3[s]) && (a = (o2 < 3 ? r2(a) : o2 > 3 ? r2(t2, i2, a) : r2(t2, i2)) || a);
          return o2 > 3 && a && Object.defineProperty(t2, i2, a), a;
        }
        Object.create;
        Object.create;
      }, function(e2, t) {
        var i;
        i = function() {
          return this;
        }();
        try {
          i = i || new Function("return this")();
        } catch (e3) {
          typeof window == "object" && (i = window);
        }
        e2.exports = i;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "CellMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n\nvec3 computeCustomDiffuseLighting(lightingInfo info,vec3 diffuseBase,float shadow)\n{\ndiffuseBase=info.diffuse*shadow;\n#ifdef CELLBASIC\nfloat level=1.0;\nif (info.ndl<0.5)\nlevel=0.5;\ndiffuseBase.rgb*vec3(level,level,level);\n#else\nfloat ToonThresholds[4];\nToonThresholds[0]=0.95;\nToonThresholds[1]=0.5;\nToonThresholds[2]=0.2;\nToonThresholds[3]=0.03;\nfloat ToonBrightnessLevels[5];\nToonBrightnessLevels[0]=1.0;\nToonBrightnessLevels[1]=0.8;\nToonBrightnessLevels[2]=0.6;\nToonBrightnessLevels[3]=0.35;\nToonBrightnessLevels[4]=0.2;\nif (info.ndl>ToonThresholds[0])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[0];\n}\nelse if (info.ndl>ToonThresholds[1])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[1];\n}\nelse if (info.ndl>ToonThresholds[2])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[2];\n}\nelse if (info.ndl>ToonThresholds[3])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[3];\n}\nelse\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[4];\n}\n#endif\nreturn max(diffuseBase,vec3(0.2));\n}\nvoid main(void)\n{\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nlightingInfo info;\nvec3 diffuseBase=vec3(0.,0.,0.);\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";
        r.Effect.ShadersStore.cellPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";
        r.Effect.ShadersStore.cellVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.DIFFUSE = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.POINTSIZE = false, t3.FOG = false, t3.NORMAL = false, t3.UV1 = false, t3.UV2 = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.NDOTL = true, t3.CUSTOMUSERLIGHTING = true, t3.CELLBASIC = true, t3.DEPTHPREPASS = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.diffuseColor = new r.Color3(1, 1, 1), n2._computeHighLevel = false, n2._disableLighting = false, n2._maxSimultaneousLights = 4, n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (n2._areTexturesDirty && (n2._needUVs = false, o2.texturesEnabled && this._diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled)) {
              if (!this._diffuseTexture.isReady())
                return false;
              n2._needUVs = true, n2.DIFFUSE = true;
            }
            if (n2.CELLBASIC = !this.computeHighLevel, r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), n2), n2._needNormals = r.MaterialHelper.PrepareDefinesForLights(o2, e4, n2, false, this._maxSimultaneousLights, this._disableLighting), r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, true, true), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var f2 = new r.EffectFallbacks();
              n2.FOG && f2.addFallback(1, "FOG"), r.MaterialHelper.HandleFallbacksForShadows(n2, f2, this.maxSimultaneousLights), n2.NUM_BONE_INFLUENCERS > 0 && f2.addCPUSkinningFallback(0, e4), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var l = [r.VertexBuffer.PositionKind];
              n2.NORMAL && l.push(r.VertexBuffer.NormalKind), n2.UV1 && l.push(r.VertexBuffer.UVKind), n2.UV2 && l.push(r.VertexBuffer.UV2Kind), n2.VERTEXCOLOR && l.push(r.VertexBuffer.ColorKind), r.MaterialHelper.PrepareAttributesForBones(l, e4, n2, f2), r.MaterialHelper.PrepareAttributesForInstances(l, n2);
              var u = n2.toString(), c = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vDiffuseColor", "vFogInfos", "vFogColor", "pointSize", "vDiffuseInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "diffuseMatrix"], d = ["diffuseSampler"], p = new Array();
              r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: n2, maxSimultaneousLights: this.maxSimultaneousLights }), t3.setEffect(o2.getEngine().createEffect("cell", { attributes: l, uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: u, fallbacks: f2, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights - 1 } }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              a2 && (this._activeEffect = a2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), this._mustRebind(n2, a2) && (this._diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled && (this._activeEffect.setTexture("diffuseSampler", this._diffuseTexture), this._activeEffect.setFloat2("vDiffuseInfos", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level), this._activeEffect.setMatrix("diffuseMatrix", this._diffuseTexture.getTextureMatrix())), r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(a2, n2)), this._activeEffect.setColor4("vDiffuseColor", this.diffuseColor, this.alpha * t3.visibility), n2.lightsEnabled && !this.disableLighting && r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2, this._maxSimultaneousLights), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.getAnimatables = function() {
            var e4 = [];
            return this._diffuseTexture && this._diffuseTexture.animations && this._diffuseTexture.animations.length > 0 && e4.push(this._diffuseTexture), e4;
          }, t2.prototype.getActiveTextures = function() {
            var t3 = e3.prototype.getActiveTextures.call(this);
            return this._diffuseTexture && t3.push(this._diffuseTexture), t3;
          }, t2.prototype.hasTexture = function(t3) {
            return !!e3.prototype.hasTexture.call(this, t3) || this._diffuseTexture === t3;
          }, t2.prototype.dispose = function(t3) {
            this._diffuseTexture && this._diffuseTexture.dispose(), e3.prototype.dispose.call(this, t3);
          }, t2.prototype.getClassName = function() {
            return "CellMaterial";
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.CellMaterial", e4;
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture")], t2.prototype, "_diffuseTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture", void 0), Object(n.a)([Object(r.serializeAsColor3)("diffuse")], t2.prototype, "diffuseColor", void 0), Object(n.a)([Object(r.serialize)("computeHighLevel")], t2.prototype, "_computeHighLevel", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "computeHighLevel", void 0), Object(n.a)([Object(r.serialize)("disableLighting")], t2.prototype, "_disableLighting", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "disableLighting", void 0), Object(n.a)([Object(r.serialize)("maxSimultaneousLights")], t2.prototype, "_maxSimultaneousLights", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "maxSimultaneousLights", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.CellMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "FireMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\nuniform sampler2D distortionSampler;\nuniform sampler2D opacitySampler;\n#ifdef DIFFUSE\nvarying vec2 vDistortionCoords1;\nvarying vec2 vDistortionCoords2;\nvarying vec2 vDistortionCoords3;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvec4 bx2(vec4 x)\n{\nreturn vec4(2.0)*x-vec4(1.0);\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\n\nfloat alpha=1.0;\n#ifdef DIFFUSE\n\nconst float distortionAmount0=0.092;\nconst float distortionAmount1=0.092;\nconst float distortionAmount2=0.092;\nvec2 heightAttenuation=vec2(0.3,0.39);\nvec4 noise0=texture2D(distortionSampler,vDistortionCoords1);\nvec4 noise1=texture2D(distortionSampler,vDistortionCoords2);\nvec4 noise2=texture2D(distortionSampler,vDistortionCoords3);\nvec4 noiseSum=bx2(noise0)*distortionAmount0+bx2(noise1)*distortionAmount1+bx2(noise2)*distortionAmount2;\nvec4 perturbedBaseCoords=vec4(vDiffuseUV,0.0,1.0)+noiseSum*(vDiffuseUV.y*heightAttenuation.x+heightAttenuation.y);\nvec4 opacityColor=texture2D(opacitySampler,perturbedBaseCoords.xy);\n#ifdef ALPHATEST\nif (opacityColor.r<0.1)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor=texture2D(diffuseSampler,perturbedBaseCoords.xy)*2.0;\nbaseColor*=opacityColor;\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(1.0,1.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec4 color=vec4(baseColor.rgb,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";
        r.Effect.ShadersStore.firePixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n\nuniform float time;\nuniform float speed;\n#ifdef DIFFUSE\nvarying vec2 vDistortionCoords1;\nvarying vec2 vDistortionCoords2;\nvarying vec2 vDistortionCoords3;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n\n#ifdef DIFFUSE\nvDiffuseUV=uv;\nvDiffuseUV.y-=0.2;\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n#ifdef DIFFUSE\n\nvec3 layerSpeed=vec3(-0.2,-0.52,-0.1)*speed;\nvDistortionCoords1.x=uv.x;\nvDistortionCoords1.y=uv.y+layerSpeed.x*time/1000.0;\nvDistortionCoords2.x=uv.x;\nvDistortionCoords2.y=uv.y+layerSpeed.y*time/1000.0;\nvDistortionCoords3.x=uv.x;\nvDistortionCoords3.y=uv.y+layerSpeed.z*time/1000.0;\n#endif\n}\n";
        r.Effect.ShadersStore.fireVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.DIFFUSE = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.DEPTHPREPASS = false, t3.POINTSIZE = false, t3.FOG = false, t3.UV1 = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.BonesPerMesh = 0, t3.NUM_BONE_INFLUENCERS = 0, t3.INSTANCES = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.diffuseColor = new r.Color3(1, 1, 1), n2.speed = 1, n2._scaledDiffuse = new r.Color3(), n2._lastTime = 0, n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return false;
          }, t2.prototype.needAlphaTesting = function() {
            return true;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (n2._areTexturesDirty && (n2._needUVs = false, this._diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled)) {
              if (!this._diffuseTexture.isReady())
                return false;
              n2._needUVs = true, n2.DIFFUSE = true;
            }
            if (n2.ALPHATEST = !!this._opacityTexture, n2._areMiscDirty && (n2.POINTSIZE = this.pointsCloud || o2.forcePointsCloud, n2.FOG = o2.fogEnabled && e4.applyFog && o2.fogMode !== r.Scene.FOGMODE_NONE && this.fogEnabled), r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, false, true), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var f2 = new r.EffectFallbacks();
              n2.FOG && f2.addFallback(1, "FOG"), n2.NUM_BONE_INFLUENCERS > 0 && f2.addCPUSkinningFallback(0, e4), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var l = [r.VertexBuffer.PositionKind];
              n2.UV1 && l.push(r.VertexBuffer.UVKind), n2.VERTEXCOLOR && l.push(r.VertexBuffer.ColorKind), r.MaterialHelper.PrepareAttributesForBones(l, e4, n2, f2), r.MaterialHelper.PrepareAttributesForInstances(l, n2);
              var u = n2.toString();
              t3.setEffect(o2.getEngine().createEffect("fire", { attributes: l, uniformsNames: ["world", "view", "viewProjection", "vEyePosition", "vFogInfos", "vFogColor", "pointSize", "vDiffuseInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "diffuseMatrix", "time", "speed"], uniformBuffersNames: [], samplers: ["diffuseSampler", "distortionSampler", "opacitySampler"], defines: u, fallbacks: f2, onCompiled: this.onCompiled, onError: this.onError, indexParameters: null, maxSimultaneousLights: 4, transformFeedbackVaryings: null }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene();
            if (i2._materialDefines) {
              var o2 = i2.effect;
              o2 && (this._activeEffect = o2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), this._mustRebind(n2, o2) && (this._diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled && (this._activeEffect.setTexture("diffuseSampler", this._diffuseTexture), this._activeEffect.setFloat2("vDiffuseInfos", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level), this._activeEffect.setMatrix("diffuseMatrix", this._diffuseTexture.getTextureMatrix()), this._activeEffect.setTexture("distortionSampler", this._distortionTexture), this._activeEffect.setTexture("opacitySampler", this._opacityTexture)), r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(o2, n2)), this._activeEffect.setColor4("vDiffuseColor", this._scaledDiffuse, this.alpha * t3.visibility), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._lastTime += n2.getEngine().getDeltaTime(), this._activeEffect.setFloat("time", this._lastTime), this._activeEffect.setFloat("speed", this.speed), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.getAnimatables = function() {
            var e4 = [];
            return this._diffuseTexture && this._diffuseTexture.animations && this._diffuseTexture.animations.length > 0 && e4.push(this._diffuseTexture), this._distortionTexture && this._distortionTexture.animations && this._distortionTexture.animations.length > 0 && e4.push(this._distortionTexture), this._opacityTexture && this._opacityTexture.animations && this._opacityTexture.animations.length > 0 && e4.push(this._opacityTexture), e4;
          }, t2.prototype.getActiveTextures = function() {
            var t3 = e3.prototype.getActiveTextures.call(this);
            return this._diffuseTexture && t3.push(this._diffuseTexture), this._distortionTexture && t3.push(this._distortionTexture), this._opacityTexture && t3.push(this._opacityTexture), t3;
          }, t2.prototype.hasTexture = function(t3) {
            return !!e3.prototype.hasTexture.call(this, t3) || (this._diffuseTexture === t3 || (this._distortionTexture === t3 || this._opacityTexture === t3));
          }, t2.prototype.getClassName = function() {
            return "FireMaterial";
          }, t2.prototype.dispose = function(t3) {
            this._diffuseTexture && this._diffuseTexture.dispose(), this._distortionTexture && this._distortionTexture.dispose(), e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var t3 = e3.prototype.serialize.call(this);
            return t3.customType = "BABYLON.FireMaterial", t3.diffuseColor = this.diffuseColor.asArray(), t3.speed = this.speed, this._diffuseTexture && (t3._diffuseTexture = this._diffuseTexture.serialize()), this._distortionTexture && (t3._distortionTexture = this._distortionTexture.serialize()), this._opacityTexture && (t3._opacityTexture = this._opacityTexture.serialize()), t3;
          }, t2.Parse = function(e4, i2, n2) {
            var o2 = new t2(e4.name, i2);
            return o2.diffuseColor = r.Color3.FromArray(e4.diffuseColor), o2.speed = e4.speed, o2.alpha = e4.alpha, o2.id = e4.id, r.Tags.AddTagsTo(o2, e4.tags), o2.backFaceCulling = e4.backFaceCulling, o2.wireframe = e4.wireframe, e4._diffuseTexture && (o2._diffuseTexture = r.Texture.Parse(e4._diffuseTexture, i2, n2)), e4._distortionTexture && (o2._distortionTexture = r.Texture.Parse(e4._distortionTexture, i2, n2)), e4._opacityTexture && (o2._opacityTexture = r.Texture.Parse(e4._opacityTexture, i2, n2)), o2;
          }, Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture")], t2.prototype, "_diffuseTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture", void 0), Object(n.a)([Object(r.serializeAsTexture)("distortionTexture")], t2.prototype, "_distortionTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "distortionTexture", void 0), Object(n.a)([Object(r.serializeAsTexture)("opacityTexture")], t2.prototype, "_opacityTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "opacityTexture", void 0), Object(n.a)([Object(r.serializeAsColor3)("diffuse")], t2.prototype, "diffuseColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "speed", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.FireMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "FurMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nuniform vec4 furColor;\nuniform float furLength;\nvarying vec3 vPositionW;\nvarying float vfur_length;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef HIGHLEVEL\nuniform float furOffset;\nuniform float furOcclusion;\nuniform sampler2D furTexture;\nvarying vec2 vFurUV;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<fogFragmentDeclaration>\n#include<clipPlaneFragmentDeclaration>\nfloat Rand(vec3 rv) {\nfloat x=dot(rv,vec3(12.9898,78.233,24.65487));\nreturn fract(sin(x)*43758.5453);\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=furColor;\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor*=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef HIGHLEVEL\n\nvec4 furTextureColor=texture2D(furTexture,vec2(vFurUV.x,vFurUV.y));\nif (furTextureColor.a<=0.0 || furTextureColor.g<furOffset) {\ndiscard;\n}\nfloat occlusion=mix(0.0,furTextureColor.b*1.2,furOffset);\nbaseColor=vec4(baseColor.xyz*max(occlusion,furOcclusion),1.1-furOffset);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase.rgb*baseColor.rgb,0.0,1.0);\n\n#ifdef HIGHLEVEL\nvec4 color=vec4(finalDiffuse,alpha);\n#else\nfloat r=vfur_length/furLength*0.5;\nvec4 color=vec4(finalDiffuse*(0.5+r),alpha);\n#endif\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";
        r.Effect.ShadersStore.furPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform float furLength;\nuniform float furAngle;\n#ifdef HIGHLEVEL\nuniform float furOffset;\nuniform vec3 furGravity;\nuniform float furTime;\nuniform float furSpacing;\nuniform float furDensity;\n#endif\n#ifdef HEIGHTMAP\nuniform sampler2D heightTexture;\n#endif\n#ifdef HIGHLEVEL\nvarying vec2 vFurUV;\n#endif\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\nvarying float vfur_length;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nfloat Rand(vec3 rv) {\nfloat x=dot(rv,vec3(12.9898,78.233,24.65487));\nreturn fract(sin(x)*43758.5453);\n}\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\n\nfloat r=Rand(position);\n#ifdef HEIGHTMAP\n#if __VERSION__>100\nvfur_length=furLength*texture(heightTexture,uv).x;\n#else\nvfur_length=furLength*texture2D(heightTexture,uv).r;\n#endif\n#else\nvfur_length=(furLength*r);\n#endif\nvec3 tangent1=vec3(normal.y,-normal.x,0);\nvec3 tangent2=vec3(-normal.z,0,normal.x);\nr=Rand(tangent1*r);\nfloat J=(2.0+4.0*r);\nr=Rand(tangent2*r);\nfloat K=(2.0+2.0*r);\ntangent1=tangent1*J+tangent2*K;\ntangent1=normalize(tangent1);\nvec3 newPosition=position+normal*vfur_length*cos(furAngle)+tangent1*vfur_length*sin(furAngle);\n#ifdef HIGHLEVEL\n\nvec3 forceDirection=vec3(0.0,0.0,0.0);\nforceDirection.x=sin(furTime+position.x*0.05)*0.2;\nforceDirection.y=cos(furTime*0.7+position.y*0.04)*0.2;\nforceDirection.z=sin(furTime*0.7+position.z*0.04)*0.2;\nvec3 displacement=vec3(0.0,0.0,0.0);\ndisplacement=furGravity+forceDirection;\nfloat displacementFactor=pow(furOffset,3.0);\nvec3 aNormal=normal;\naNormal.xyz+=displacement*displacementFactor;\nnewPosition=vec3(newPosition.x,newPosition.y,newPosition.z)+(normalize(aNormal)*furOffset*furSpacing);\n#endif\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\ngl_Position=viewProjection*finalWorld*vec4(newPosition,1.0);\nvec4 worldPos=finalWorld*vec4(newPosition,1.0);\nvPositionW=vec3(worldPos);\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#ifdef HIGHLEVEL\nvFurUV=vDiffuseUV*furDensity;\n#endif\n#else\n#ifdef HIGHLEVEL\nvFurUV=uv*furDensity;\n#endif\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";
        r.Effect.ShadersStore.furVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.DIFFUSE = false, t3.HEIGHTMAP = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.DEPTHPREPASS = false, t3.POINTSIZE = false, t3.FOG = false, t3.NORMAL = false, t3.UV1 = false, t3.UV2 = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.HIGHLEVEL = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.diffuseColor = new r.Color3(1, 1, 1), n2.furLength = 1, n2.furAngle = 0, n2.furColor = new r.Color3(0.44, 0.21, 0.02), n2.furOffset = 0, n2.furSpacing = 12, n2.furGravity = new r.Vector3(0, 0, 0), n2.furSpeed = 100, n2.furDensity = 20, n2.furOcclusion = 0, n2._disableLighting = false, n2._maxSimultaneousLights = 4, n2.highLevelFur = true, n2._furTime = 0, n2;
          }
          return Object(n.b)(t2, e3), Object.defineProperty(t2.prototype, "furTime", { get: function() {
            return this._furTime;
          }, set: function(e4) {
            this._furTime = e4;
          }, enumerable: false, configurable: true }), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.updateFur = function() {
            for (var e4 = 1; e4 < this._meshes.length; e4++) {
              var t3 = this._meshes[e4].material;
              t3.furLength = this.furLength, t3.furAngle = this.furAngle, t3.furGravity = this.furGravity, t3.furSpacing = this.furSpacing, t3.furSpeed = this.furSpeed, t3.furColor = this.furColor, t3.diffuseTexture = this.diffuseTexture, t3.furTexture = this.furTexture, t3.highLevelFur = this.highLevelFur, t3.furTime = this.furTime, t3.furDensity = this.furDensity;
            }
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (n2._areTexturesDirty && o2.texturesEnabled) {
              if (this.diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled) {
                if (!this.diffuseTexture.isReady())
                  return false;
                n2._needUVs = true, n2.DIFFUSE = true;
              }
              if (this.heightTexture && a2.getCaps().maxVertexTextureImageUnits) {
                if (!this.heightTexture.isReady())
                  return false;
                n2._needUVs = true, n2.HEIGHTMAP = true;
              }
            }
            if (this.highLevelFur !== n2.HIGHLEVEL && (n2.HIGHLEVEL = true, n2.markAsUnprocessed()), r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), n2), n2._needNormals = r.MaterialHelper.PrepareDefinesForLights(o2, e4, n2, false, this._maxSimultaneousLights, this._disableLighting), r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, true, true), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var f2 = new r.EffectFallbacks();
              n2.FOG && f2.addFallback(1, "FOG"), r.MaterialHelper.HandleFallbacksForShadows(n2, f2, this.maxSimultaneousLights), n2.NUM_BONE_INFLUENCERS > 0 && f2.addCPUSkinningFallback(0, e4), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var l = [r.VertexBuffer.PositionKind];
              n2.NORMAL && l.push(r.VertexBuffer.NormalKind), n2.UV1 && l.push(r.VertexBuffer.UVKind), n2.UV2 && l.push(r.VertexBuffer.UV2Kind), n2.VERTEXCOLOR && l.push(r.VertexBuffer.ColorKind), r.MaterialHelper.PrepareAttributesForBones(l, e4, n2, f2), r.MaterialHelper.PrepareAttributesForInstances(l, n2);
              var u = n2.toString(), c = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vDiffuseColor", "vFogInfos", "vFogColor", "pointSize", "vDiffuseInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "diffuseMatrix", "furLength", "furAngle", "furColor", "furOffset", "furGravity", "furTime", "furSpacing", "furDensity", "furOcclusion"], d = ["diffuseSampler", "heightTexture", "furTexture"], p = new Array();
              r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: n2, maxSimultaneousLights: this.maxSimultaneousLights }), t3.setEffect(o2.getEngine().createEffect("fur", { attributes: l, uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: u, fallbacks: f2, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights } }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              a2 && (this._activeEffect = a2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), n2.getCachedMaterial() !== this && (this._diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled && (this._activeEffect.setTexture("diffuseSampler", this._diffuseTexture), this._activeEffect.setFloat2("vDiffuseInfos", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level), this._activeEffect.setMatrix("diffuseMatrix", this._diffuseTexture.getTextureMatrix())), this._heightTexture && this._activeEffect.setTexture("heightTexture", this._heightTexture), r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(a2, n2)), this._activeEffect.setColor4("vDiffuseColor", this.diffuseColor, this.alpha * t3.visibility), n2.lightsEnabled && !this.disableLighting && r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2, this.maxSimultaneousLights), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._activeEffect.setFloat("furLength", this.furLength), this._activeEffect.setFloat("furAngle", this.furAngle), this._activeEffect.setColor4("furColor", this.furColor, 1), this.highLevelFur && (this._activeEffect.setVector3("furGravity", this.furGravity), this._activeEffect.setFloat("furOffset", this.furOffset), this._activeEffect.setFloat("furSpacing", this.furSpacing), this._activeEffect.setFloat("furDensity", this.furDensity), this._activeEffect.setFloat("furOcclusion", this.furOcclusion), this._furTime += this.getScene().getEngine().getDeltaTime() / this.furSpeed, this._activeEffect.setFloat("furTime", this._furTime), this._activeEffect.setTexture("furTexture", this.furTexture)), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.getAnimatables = function() {
            var e4 = [];
            return this.diffuseTexture && this.diffuseTexture.animations && this.diffuseTexture.animations.length > 0 && e4.push(this.diffuseTexture), this.heightTexture && this.heightTexture.animations && this.heightTexture.animations.length > 0 && e4.push(this.heightTexture), e4;
          }, t2.prototype.getActiveTextures = function() {
            var t3 = e3.prototype.getActiveTextures.call(this);
            return this._diffuseTexture && t3.push(this._diffuseTexture), this._heightTexture && t3.push(this._heightTexture), t3;
          }, t2.prototype.hasTexture = function(t3) {
            return !!e3.prototype.hasTexture.call(this, t3) || (this.diffuseTexture === t3 || this._heightTexture === t3);
          }, t2.prototype.dispose = function(t3) {
            if (this.diffuseTexture && this.diffuseTexture.dispose(), this._meshes)
              for (var i2 = 1; i2 < this._meshes.length; i2++) {
                var n2 = this._meshes[i2].material;
                n2 && n2.dispose(t3), this._meshes[i2].dispose();
              }
            e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.FurMaterial", this._meshes && (e4.sourceMeshName = this._meshes[0].name, e4.quality = this._meshes.length), e4;
          }, t2.prototype.getClassName = function() {
            return "FurMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            var o2 = r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
            return e4.sourceMeshName && o2.highLevelFur && i2.executeWhenReady(function() {
              var n3 = i2.getMeshByName(e4.sourceMeshName);
              if (n3) {
                var r2 = t2.GenerateTexture("Fur Texture", i2);
                o2.furTexture = r2, t2.FurifyMesh(n3, e4.quality);
              }
            }), o2;
          }, t2.GenerateTexture = function(e4, t3) {
            for (var i2 = new r.DynamicTexture("FurTexture " + e4, 256, t3, true), n2 = i2.getContext(), o2 = 0; o2 < 2e4; ++o2)
              n2.fillStyle = "rgba(255, " + Math.floor(255 * Math.random()) + ", " + Math.floor(255 * Math.random()) + ", 1)", n2.fillRect(Math.random() * i2.getSize().width, Math.random() * i2.getSize().height, 2, 2);
            return i2.update(false), i2.wrapU = r.Texture.WRAP_ADDRESSMODE, i2.wrapV = r.Texture.WRAP_ADDRESSMODE, i2;
          }, t2.FurifyMesh = function(e4, i2) {
            var n2, o2 = [e4], a2 = e4.material;
            if (!(a2 instanceof t2))
              throw "The material of the source mesh must be a Fur Material";
            for (n2 = 1; n2 < i2; n2++) {
              var s2 = new t2(a2.name + n2, e4.getScene());
              e4.getScene().materials.pop(), r.Tags.EnableFor(s2), r.Tags.AddTagsTo(s2, "furShellMaterial"), s2.furLength = a2.furLength, s2.furAngle = a2.furAngle, s2.furGravity = a2.furGravity, s2.furSpacing = a2.furSpacing, s2.furSpeed = a2.furSpeed, s2.furColor = a2.furColor, s2.diffuseTexture = a2.diffuseTexture, s2.furOffset = n2 / i2, s2.furTexture = a2.furTexture, s2.highLevelFur = a2.highLevelFur, s2.furTime = a2.furTime, s2.furDensity = a2.furDensity;
              var f2 = e4.clone(e4.name + n2);
              f2.material = s2, f2.skeleton = e4.skeleton, f2.position = r.Vector3.Zero(), o2.push(f2);
            }
            for (n2 = 1; n2 < o2.length; n2++)
              o2[n2].parent = e4;
            return e4.material._meshes = o2, o2;
          }, Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture")], t2.prototype, "_diffuseTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture", void 0), Object(n.a)([Object(r.serializeAsTexture)("heightTexture")], t2.prototype, "_heightTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "heightTexture", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "diffuseColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "furLength", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "furAngle", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "furColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "furOffset", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "furSpacing", void 0), Object(n.a)([Object(r.serializeAsVector3)()], t2.prototype, "furGravity", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "furSpeed", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "furDensity", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "furOcclusion", void 0), Object(n.a)([Object(r.serialize)("disableLighting")], t2.prototype, "_disableLighting", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "disableLighting", void 0), Object(n.a)([Object(r.serialize)("maxSimultaneousLights")], t2.prototype, "_maxSimultaneousLights", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "maxSimultaneousLights", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "highLevelFur", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "furTime", null), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.FurMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "GradientMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\n\nuniform vec4 topColor;\nuniform vec4 bottomColor;\nuniform float offset;\nuniform float scale;\nuniform float smoothness;\n\nvarying vec3 vPositionW;\nvarying vec3 vPosition;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\nfloat h=vPosition.y*scale+offset;\nfloat mysmoothness=clamp(smoothness,0.01,max(smoothness,10.));\nvec4 baseColor=mix(bottomColor,topColor,max(pow(max(h,0.0),mysmoothness),0.0));\n\nvec3 diffuseColor=baseColor.rgb;\n\nfloat alpha=baseColor.a;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\n#ifdef EMISSIVE\nvec3 diffuseBase=baseColor.rgb;\n#else\nvec3 diffuseBase=vec3(0.,0.,0.);\n#endif\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}\n";
        r.Effect.ShadersStore.gradientPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vPosition;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\nvPosition=position;\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";
        r.Effect.ShadersStore.gradientVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.EMISSIVE = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.DEPTHPREPASS = false, t3.POINTSIZE = false, t3.FOG = false, t3.NORMAL = false, t3.UV1 = false, t3.UV2 = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2._maxSimultaneousLights = 4, n2.topColor = new r.Color3(1, 0, 0), n2.topColorAlpha = 1, n2.bottomColor = new r.Color3(0, 0, 1), n2.bottomColorAlpha = 1, n2.offset = 0, n2.scale = 1, n2.smoothness = 1, n2._disableLighting = false, n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1 || this.topColorAlpha < 1 || this.bottomColorAlpha < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return true;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), n2), n2._needNormals = r.MaterialHelper.PrepareDefinesForLights(o2, e4, n2, false, this._maxSimultaneousLights, this._disableLighting), n2.EMISSIVE = this._disableLighting, r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, false, true), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var f2 = new r.EffectFallbacks();
              n2.FOG && f2.addFallback(1, "FOG"), r.MaterialHelper.HandleFallbacksForShadows(n2, f2), n2.NUM_BONE_INFLUENCERS > 0 && f2.addCPUSkinningFallback(0, e4), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var l = [r.VertexBuffer.PositionKind];
              n2.NORMAL && l.push(r.VertexBuffer.NormalKind), n2.UV1 && l.push(r.VertexBuffer.UVKind), n2.UV2 && l.push(r.VertexBuffer.UV2Kind), n2.VERTEXCOLOR && l.push(r.VertexBuffer.ColorKind), r.MaterialHelper.PrepareAttributesForBones(l, e4, n2, f2), r.MaterialHelper.PrepareAttributesForInstances(l, n2);
              var u = n2.toString(), c = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vFogInfos", "vFogColor", "pointSize", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "topColor", "bottomColor", "offset", "smoothness", "scale"], d = [], p = new Array();
              r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: n2, maxSimultaneousLights: 4 }), t3.setEffect(o2.getEngine().createEffect("gradient", { attributes: l, uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: u, fallbacks: f2, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: 4 } }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              a2 && (this._activeEffect = a2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, a2), this._mustRebind(n2, a2) && (r.MaterialHelper.BindClipPlane(a2, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(a2, n2)), n2.lightsEnabled && !this.disableLighting && r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2, this.maxSimultaneousLights), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._activeEffect.setColor4("topColor", this.topColor, this.topColorAlpha), this._activeEffect.setColor4("bottomColor", this.bottomColor, this.bottomColorAlpha), this._activeEffect.setFloat("offset", this.offset), this._activeEffect.setFloat("scale", this.scale), this._activeEffect.setFloat("smoothness", this.smoothness), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.getAnimatables = function() {
            return [];
          }, t2.prototype.dispose = function(t3) {
            e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.GradientMaterial", e4;
          }, t2.prototype.getClassName = function() {
            return "GradientMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, Object(n.a)([Object(r.serialize)("maxSimultaneousLights")], t2.prototype, "_maxSimultaneousLights", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "maxSimultaneousLights", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "topColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "topColorAlpha", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "bottomColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "bottomColorAlpha", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "offset", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "scale", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "smoothness", void 0), Object(n.a)([Object(r.serialize)("disableLighting")], t2.prototype, "_disableLighting", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "disableLighting", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.GradientMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "GridMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "#extension GL_OES_standard_derivatives : enable\n#define SQRT2 1.41421356\n#define PI 3.14159\nprecision highp float;\nuniform vec3 mainColor;\nuniform vec3 lineColor;\nuniform vec4 gridControl;\nuniform vec3 gridOffset;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogFragmentDeclaration>\n\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\nfloat getVisibility(float position) {\n\nfloat majorGridFrequency=gridControl.y;\nif (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)\n{\nreturn 1.0;\n}\nreturn gridControl.z;\n}\nfloat getAnisotropicAttenuation(float differentialLength) {\nconst float maxNumberOfLines=10.0;\nreturn clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);\n}\nfloat isPointOnLine(float position,float differentialLength) {\nfloat fractionPartOfPosition=position-floor(position+0.5);\nfractionPartOfPosition/=differentialLength;\nfractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);\nfloat result=0.5+0.5*cos(fractionPartOfPosition*PI);\nreturn result;\n}\nfloat contributionOnAxis(float position) {\nfloat differentialLength=length(vec2(dFdx(position),dFdy(position)));\ndifferentialLength*=SQRT2;\n\nfloat result=isPointOnLine(position,differentialLength);\n\nfloat visibility=getVisibility(position);\nresult*=visibility;\n\nfloat anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\nresult*=anisotropicAttenuation;\nreturn result;\n}\nfloat normalImpactOnAxis(float x) {\nfloat normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);\nreturn normalImpact;\n}\nvoid main(void) {\n\nfloat gridRatio=gridControl.x;\nvec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;\n\nfloat x=contributionOnAxis(gridPos.x);\nfloat y=contributionOnAxis(gridPos.y);\nfloat z=contributionOnAxis(gridPos.z);\n\nvec3 normal=normalize(vNormal);\nx*=normalImpactOnAxis(normal.x);\ny*=normalImpactOnAxis(normal.y);\nz*=normalImpactOnAxis(normal.z);\n\nfloat grid=clamp(x+y+z,0.,1.);\n\nvec3 color=mix(mainColor,lineColor,grid);\n#ifdef FOG\n#include<fogFragment>\n#endif\nfloat opacity=1.0;\n#ifdef TRANSPARENT\nopacity=clamp(grid,0.08,gridControl.w*grid);\n#endif\n#ifdef OPACITY\nopacity*=texture2D(opacitySampler,vOpacityUV).a;\n#endif\n\ngl_FragColor=vec4(color.rgb,opacity);\n#ifdef TRANSPARENT\n#ifdef PREMULTIPLYALPHA\ngl_FragColor.rgb*=opacity;\n#endif\n#else\n#endif\n#include<imageProcessingCompatibility>\n}";
        r.Effect.ShadersStore.gridPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#include<instancesDeclaration>\n\nuniform mat4 projection;\nuniform mat4 view;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogVertexDeclaration>\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\nvoid main(void) {\n#include<instancesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#include<fogVertex>\nvec4 cameraSpacePosition=view*worldPos;\ngl_Position=projection*cameraSpacePosition;\n#ifdef OPACITY\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\nvPosition=position;\nvNormal=normal;\n}";
        r.Effect.ShadersStore.gridVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.OPACITY = false, t3.TRANSPARENT = false, t3.FOG = false, t3.PREMULTIPLYALPHA = false, t3.UV1 = false, t3.UV2 = false, t3.INSTANCES = false, t3.THIN_INSTANCES = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.mainColor = r.Color3.Black(), n2.lineColor = r.Color3.Teal(), n2.gridRatio = 1, n2.gridOffset = r.Vector3.Zero(), n2.majorUnitFrequency = 10, n2.minorUnitVisibility = 0.33, n2.opacity = 1, n2.preMultiplyAlpha = false, n2._gridControl = new r.Vector4(n2.gridRatio, n2.majorUnitFrequency, n2.minorUnitVisibility, n2.opacity), n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this.opacity < 1 || this._opacityTexture && this._opacityTexture.isReady();
          }, t2.prototype.needAlphaBlendingForMesh = function(e4) {
            return this.needAlphaBlending();
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            if (n2.TRANSPARENT !== this.opacity < 1 && (n2.TRANSPARENT = !n2.TRANSPARENT, n2.markAsUnprocessed()), n2.PREMULTIPLYALPHA != this.preMultiplyAlpha && (n2.PREMULTIPLYALPHA = !n2.PREMULTIPLYALPHA, n2.markAsUnprocessed()), n2._areTexturesDirty && (n2._needUVs = false, o2.texturesEnabled && this._opacityTexture && r.MaterialFlags.OpacityTextureEnabled)) {
              if (!this._opacityTexture.isReady())
                return false;
              n2._needUVs = true, n2.OPACITY = true;
            }
            if (r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, false, this.fogEnabled, false, n2), r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, o2.getEngine(), n2, !!i2), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial(), r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, false, false);
              var a2 = [r.VertexBuffer.PositionKind, r.VertexBuffer.NormalKind];
              n2.UV1 && a2.push(r.VertexBuffer.UVKind), n2.UV2 && a2.push(r.VertexBuffer.UV2Kind), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess, r.MaterialHelper.PrepareAttributesForInstances(a2, n2);
              var f2 = n2.toString();
              t3.setEffect(o2.getEngine().createEffect("grid", a2, ["projection", "mainColor", "lineColor", "gridControl", "gridOffset", "vFogInfos", "vFogColor", "world", "view", "opacityMatrix", "vOpacityInfos"], ["opacitySampler"], f2, void 0, this.onCompiled, this.onError), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              a2 && (this._activeEffect = a2, o2.INSTANCES && !o2.THIN_INSTANCE || this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("view", n2.getViewMatrix()), this._activeEffect.setMatrix("projection", n2.getProjectionMatrix()), this._mustRebind(n2, a2) && (this._activeEffect.setColor3("mainColor", this.mainColor), this._activeEffect.setColor3("lineColor", this.lineColor), this._activeEffect.setVector3("gridOffset", this.gridOffset), this._gridControl.x = this.gridRatio, this._gridControl.y = Math.round(this.majorUnitFrequency), this._gridControl.z = this.minorUnitVisibility, this._gridControl.w = this.opacity, this._activeEffect.setVector4("gridControl", this._gridControl), this._opacityTexture && r.MaterialFlags.OpacityTextureEnabled && (this._activeEffect.setTexture("opacitySampler", this._opacityTexture), this._activeEffect.setFloat2("vOpacityInfos", this._opacityTexture.coordinatesIndex, this._opacityTexture.level), this._activeEffect.setMatrix("opacityMatrix", this._opacityTexture.getTextureMatrix()))), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.dispose = function(t3) {
            e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.GridMaterial", e4;
          }, t2.prototype.getClassName = function() {
            return "GridMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "mainColor", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "lineColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "gridRatio", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "gridOffset", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "majorUnitFrequency", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "minorUnitVisibility", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "opacity", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "preMultiplyAlpha", void 0), Object(n.a)([Object(r.serializeAsTexture)("opacityTexture")], t2.prototype, "_opacityTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "opacityTexture", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.GridMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "LavaMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n\nuniform float time;\nuniform float speed;\nuniform float movingSpeed;\nuniform vec3 fogColor;\nuniform sampler2D noiseTexture;\nuniform float fogDensity;\n\nvarying float noise;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nfloat random( vec3 scale,float seed ){\nreturn fract( sin( dot( gl_FragCoord.xyz+seed,scale ) )*43758.5453+seed ) ;\n}\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\n\nvec4 noiseTex=texture2D( noiseTexture,vDiffuseUV );\nvec2 T1=vDiffuseUV+vec2( 1.5,-1.5 )*time*0.02;\nvec2 T2=vDiffuseUV+vec2( -0.5,2.0 )*time*0.01*speed;\nT1.x+=noiseTex.x*2.0;\nT1.y+=noiseTex.y*2.0;\nT2.x-=noiseTex.y*0.2+time*0.001*movingSpeed;\nT2.y+=noiseTex.z*0.2+time*0.002*movingSpeed;\nfloat p=texture2D( noiseTexture,T1*3.0 ).a;\nvec4 lavaColor=texture2D( diffuseSampler,T2*4.0);\nvec4 temp=lavaColor*( vec4( p,p,p,p )*2. )+( lavaColor*lavaColor-0.1 );\nbaseColor=temp;\nfloat depth=gl_FragCoord.z*4.0;\nconst float LOG2=1.442695;\nfloat fogFactor=exp2(-fogDensity*fogDensity*depth*depth*LOG2 );\nfogFactor=1.0-clamp( fogFactor,0.0,1.0 );\nbaseColor=mix( baseColor,vec4( fogColor,baseColor.w ),fogFactor );\ndiffuseColor=baseColor.rgb;\n\n\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";
        r.Effect.ShadersStore.lavaPixelShader = o;
        var a = "precision highp float;\n\nuniform float time;\nuniform float lowFrequencySpeed;\n\nvarying float noise;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n\n\nvec3 mod289(vec3 x)\n{\nreturn x-floor(x*(1.0/289.0))*289.0;\n}\nvec4 mod289(vec4 x)\n{\nreturn x-floor(x*(1.0/289.0))*289.0;\n}\nvec4 permute(vec4 x)\n{\nreturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r)\n{\nreturn 1.79284291400159-0.85373472095314*r;\n}\nvec3 fade(vec3 t) {\nreturn t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\nfloat pnoise(vec3 P,vec3 rep)\n{\nvec3 Pi0=mod(floor(P),rep);\nvec3 Pi1=mod(Pi0+vec3(1.0),rep);\nPi0=mod289(Pi0);\nPi1=mod289(Pi1);\nvec3 Pf0=fract(P);\nvec3 Pf1=Pf0-vec3(1.0);\nvec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);\nvec4 iy=vec4(Pi0.yy,Pi1.yy);\nvec4 iz0=Pi0.zzzz;\nvec4 iz1=Pi1.zzzz;\nvec4 ixy=permute(permute(ix)+iy);\nvec4 ixy0=permute(ixy+iz0);\nvec4 ixy1=permute(ixy+iz1);\nvec4 gx0=ixy0*(1.0/7.0);\nvec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;\ngx0=fract(gx0);\nvec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);\nvec4 sz0=step(gz0,vec4(0.0));\ngx0-=sz0*(step(0.0,gx0)-0.5);\ngy0-=sz0*(step(0.0,gy0)-0.5);\nvec4 gx1=ixy1*(1.0/7.0);\nvec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;\ngx1=fract(gx1);\nvec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);\nvec4 sz1=step(gz1,vec4(0.0));\ngx1-=sz1*(step(0.0,gx1)-0.5);\ngy1-=sz1*(step(0.0,gy1)-0.5);\nvec3 g000=vec3(gx0.x,gy0.x,gz0.x);\nvec3 g100=vec3(gx0.y,gy0.y,gz0.y);\nvec3 g010=vec3(gx0.z,gy0.z,gz0.z);\nvec3 g110=vec3(gx0.w,gy0.w,gz0.w);\nvec3 g001=vec3(gx1.x,gy1.x,gz1.x);\nvec3 g101=vec3(gx1.y,gy1.y,gz1.y);\nvec3 g011=vec3(gx1.z,gy1.z,gz1.z);\nvec3 g111=vec3(gx1.w,gy1.w,gz1.w);\nvec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));\ng000*=norm0.x;\ng010*=norm0.y;\ng100*=norm0.z;\ng110*=norm0.w;\nvec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));\ng001*=norm1.x;\ng011*=norm1.y;\ng101*=norm1.z;\ng111*=norm1.w;\nfloat n000=dot(g000,Pf0);\nfloat n100=dot(g100,vec3(Pf1.x,Pf0.yz));\nfloat n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));\nfloat n110=dot(g110,vec3(Pf1.xy,Pf0.z));\nfloat n001=dot(g001,vec3(Pf0.xy,Pf1.z));\nfloat n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));\nfloat n011=dot(g011,vec3(Pf0.x,Pf1.yz));\nfloat n111=dot(g111,Pf1);\nvec3 fade_xyz=fade(Pf0);\nvec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);\nvec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);\nfloat n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);\nreturn 2.2*n_xyz;\n}\n\nfloat turbulence( vec3 p ) {\nfloat w=100.0;\nfloat t=-.5;\nfor (float f=1.0 ; f<=10.0 ; f++ ){\nfloat power=pow( 2.0,f );\nt+=abs( pnoise( vec3( power*p ),vec3( 10.0,10.0,10.0 ) )/power );\n}\nreturn t;\n}\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef NORMAL\n\nnoise=10.0*-.10*turbulence( .5*normal+time*1.15 );\n\nfloat b=lowFrequencySpeed*5.0*pnoise( 0.05*position +vec3(time*1.025),vec3( 100.0 ) );\n\nfloat displacement =-1.5*noise+b;\n\nvec3 newPosition=position+normal*displacement;\ngl_Position=viewProjection*finalWorld*vec4( newPosition,1.0 );\nvec4 worldPos=finalWorld*vec4(newPosition,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}";
        r.Effect.ShadersStore.lavaVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.DIFFUSE = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.DEPTHPREPASS = false, t3.POINTSIZE = false, t3.FOG = false, t3.LIGHT0 = false, t3.LIGHT1 = false, t3.LIGHT2 = false, t3.LIGHT3 = false, t3.SPOTLIGHT0 = false, t3.SPOTLIGHT1 = false, t3.SPOTLIGHT2 = false, t3.SPOTLIGHT3 = false, t3.HEMILIGHT0 = false, t3.HEMILIGHT1 = false, t3.HEMILIGHT2 = false, t3.HEMILIGHT3 = false, t3.DIRLIGHT0 = false, t3.DIRLIGHT1 = false, t3.DIRLIGHT2 = false, t3.DIRLIGHT3 = false, t3.POINTLIGHT0 = false, t3.POINTLIGHT1 = false, t3.POINTLIGHT2 = false, t3.POINTLIGHT3 = false, t3.SHADOW0 = false, t3.SHADOW1 = false, t3.SHADOW2 = false, t3.SHADOW3 = false, t3.SHADOWS = false, t3.SHADOWESM0 = false, t3.SHADOWESM1 = false, t3.SHADOWESM2 = false, t3.SHADOWESM3 = false, t3.SHADOWPOISSON0 = false, t3.SHADOWPOISSON1 = false, t3.SHADOWPOISSON2 = false, t3.SHADOWPOISSON3 = false, t3.SHADOWPCF0 = false, t3.SHADOWPCF1 = false, t3.SHADOWPCF2 = false, t3.SHADOWPCF3 = false, t3.SHADOWPCSS0 = false, t3.SHADOWPCSS1 = false, t3.SHADOWPCSS2 = false, t3.SHADOWPCSS3 = false, t3.NORMAL = false, t3.UV1 = false, t3.UV2 = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.UNLIT = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.speed = 1, n2.movingSpeed = 1, n2.lowFrequencySpeed = 1, n2.fogDensity = 0.15, n2._lastTime = 0, n2.diffuseColor = new r.Color3(1, 1, 1), n2._disableLighting = false, n2._unlit = false, n2._maxSimultaneousLights = 4, n2._scaledDiffuse = new r.Color3(), n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (n2._areTexturesDirty && (n2._needUVs = false, o2.texturesEnabled && this._diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled)) {
              if (!this._diffuseTexture.isReady())
                return false;
              n2._needUVs = true, n2.DIFFUSE = true;
            }
            if (r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), n2), n2._needNormals = true, r.MaterialHelper.PrepareDefinesForLights(o2, e4, n2, false, this._maxSimultaneousLights, this._disableLighting), r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, true, true), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var f2 = new r.EffectFallbacks();
              n2.FOG && f2.addFallback(1, "FOG"), r.MaterialHelper.HandleFallbacksForShadows(n2, f2), n2.NUM_BONE_INFLUENCERS > 0 && f2.addCPUSkinningFallback(0, e4), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var l = [r.VertexBuffer.PositionKind];
              n2.NORMAL && l.push(r.VertexBuffer.NormalKind), n2.UV1 && l.push(r.VertexBuffer.UVKind), n2.UV2 && l.push(r.VertexBuffer.UV2Kind), n2.VERTEXCOLOR && l.push(r.VertexBuffer.ColorKind), r.MaterialHelper.PrepareAttributesForBones(l, e4, n2, f2), r.MaterialHelper.PrepareAttributesForInstances(l, n2);
              var u = n2.toString(), c = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vDiffuseColor", "vFogInfos", "vFogColor", "pointSize", "vDiffuseInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "diffuseMatrix", "time", "speed", "movingSpeed", "fogColor", "fogDensity", "lowFrequencySpeed"], d = ["diffuseSampler", "noiseTexture"], p = new Array();
              r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: n2, maxSimultaneousLights: this.maxSimultaneousLights }), t3.setEffect(o2.getEngine().createEffect("lava", { attributes: l, uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: u, fallbacks: f2, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights } }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              a2 && (this._activeEffect = a2, o2.UNLIT = this._unlit, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), this._mustRebind(n2, a2) && (this.diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled && (this._activeEffect.setTexture("diffuseSampler", this.diffuseTexture), this._activeEffect.setFloat2("vDiffuseInfos", this.diffuseTexture.coordinatesIndex, this.diffuseTexture.level), this._activeEffect.setMatrix("diffuseMatrix", this.diffuseTexture.getTextureMatrix())), this.noiseTexture && this._activeEffect.setTexture("noiseTexture", this.noiseTexture), r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(a2, n2)), this._activeEffect.setColor4("vDiffuseColor", this._scaledDiffuse, this.alpha * t3.visibility), n2.lightsEnabled && !this.disableLighting && r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._lastTime += n2.getEngine().getDeltaTime(), this._activeEffect.setFloat("time", this._lastTime * this.speed / 1e3), this.fogColor || (this.fogColor = r.Color3.Black()), this._activeEffect.setColor3("fogColor", this.fogColor), this._activeEffect.setFloat("fogDensity", this.fogDensity), this._activeEffect.setFloat("lowFrequencySpeed", this.lowFrequencySpeed), this._activeEffect.setFloat("movingSpeed", this.movingSpeed), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.getAnimatables = function() {
            var e4 = [];
            return this.diffuseTexture && this.diffuseTexture.animations && this.diffuseTexture.animations.length > 0 && e4.push(this.diffuseTexture), this.noiseTexture && this.noiseTexture.animations && this.noiseTexture.animations.length > 0 && e4.push(this.noiseTexture), e4;
          }, t2.prototype.getActiveTextures = function() {
            var t3 = e3.prototype.getActiveTextures.call(this);
            return this._diffuseTexture && t3.push(this._diffuseTexture), t3;
          }, t2.prototype.hasTexture = function(t3) {
            return !!e3.prototype.hasTexture.call(this, t3) || this.diffuseTexture === t3;
          }, t2.prototype.dispose = function(t3) {
            this.diffuseTexture && this.diffuseTexture.dispose(), this.noiseTexture && this.noiseTexture.dispose(), e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.LavaMaterial", e4;
          }, t2.prototype.getClassName = function() {
            return "LavaMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture")], t2.prototype, "_diffuseTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture", void 0), Object(n.a)([Object(r.serializeAsTexture)()], t2.prototype, "noiseTexture", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "fogColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "speed", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "movingSpeed", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "lowFrequencySpeed", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "fogDensity", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "diffuseColor", void 0), Object(n.a)([Object(r.serialize)("disableLighting")], t2.prototype, "_disableLighting", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "disableLighting", void 0), Object(n.a)([Object(r.serialize)("unlit")], t2.prototype, "_unlit", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "unlit", void 0), Object(n.a)([Object(r.serialize)("maxSimultaneousLights")], t2.prototype, "_maxSimultaneousLights", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "maxSimultaneousLights", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.LavaMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "MixMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform sampler2D mixMap1Sampler;\nuniform vec2 vTextureInfos;\n#ifdef MIXMAP2\nuniform sampler2D mixMap2Sampler;\n#endif\nuniform sampler2D diffuse1Sampler;\nuniform sampler2D diffuse2Sampler;\nuniform sampler2D diffuse3Sampler;\nuniform sampler2D diffuse4Sampler;\nuniform vec2 diffuse1Infos;\nuniform vec2 diffuse2Infos;\nuniform vec2 diffuse3Infos;\nuniform vec2 diffuse4Infos;\n#ifdef MIXMAP2\nuniform sampler2D diffuse5Sampler;\nuniform sampler2D diffuse6Sampler;\nuniform sampler2D diffuse7Sampler;\nuniform sampler2D diffuse8Sampler;\nuniform vec2 diffuse5Infos;\nuniform vec2 diffuse6Infos;\nuniform vec2 diffuse7Infos;\nuniform vec2 diffuse8Infos;\n#endif\n#endif\n\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 finalMixColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef MIXMAP2\nvec4 mixColor2=vec4(1.,1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nvec4 mixColor=texture2D(mixMap1Sampler,vTextureUV);\n#include<depthPrePass>\nmixColor.rgb*=vTextureInfos.y;\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\nvec4 diffuse4Color=texture2D(diffuse4Sampler,vTextureUV*diffuse4Infos);\ndiffuse1Color.rgb*=mixColor.r;\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,mixColor.g);\ndiffuse3Color.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,mixColor.b);\nfinalMixColor.rgb=mix(diffuse3Color.rgb,diffuse4Color.rgb,1.0-mixColor.a);\n#ifdef MIXMAP2\nmixColor=texture2D(mixMap2Sampler,vTextureUV);\nmixColor.rgb*=vTextureInfos.y;\nvec4 diffuse5Color=texture2D(diffuse5Sampler,vTextureUV*diffuse5Infos);\nvec4 diffuse6Color=texture2D(diffuse6Sampler,vTextureUV*diffuse6Infos);\nvec4 diffuse7Color=texture2D(diffuse7Sampler,vTextureUV*diffuse7Infos);\nvec4 diffuse8Color=texture2D(diffuse8Sampler,vTextureUV*diffuse8Infos);\ndiffuse5Color.rgb=mix(finalMixColor.rgb,diffuse5Color.rgb,mixColor.r);\ndiffuse6Color.rgb=mix(diffuse5Color.rgb,diffuse6Color.rgb,mixColor.g);\ndiffuse7Color.rgb=mix(diffuse6Color.rgb,diffuse7Color.rgb,mixColor.b);\nfinalMixColor.rgb=mix(diffuse7Color.rgb,diffuse8Color.rgb,1.0-mixColor.a);\n#endif\n#endif\n#ifdef VERTEXCOLOR\nfinalMixColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*finalMixColor.rgb,0.0,1.0);\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}\n";
        r.Effect.ShadersStore.mixPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform mat4 textureMatrix;\nuniform vec2 vTextureInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vTextureInfos.x == 0.)\n{\nvTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";
        r.Effect.ShadersStore.mixVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.DIFFUSE = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.DEPTHPREPASS = false, t3.POINTSIZE = false, t3.FOG = false, t3.SPECULARTERM = false, t3.NORMAL = false, t3.UV1 = false, t3.UV2 = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.MIXMAP2 = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.diffuseColor = new r.Color3(1, 1, 1), n2.specularColor = new r.Color3(0, 0, 0), n2.specularPower = 64, n2._disableLighting = false, n2._maxSimultaneousLights = 4, n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (o2.texturesEnabled) {
              if (!this._mixTexture1 || !this._mixTexture1.isReady())
                return false;
              if (n2._needUVs = true, r.MaterialFlags.DiffuseTextureEnabled) {
                if (!this._diffuseTexture1 || !this._diffuseTexture1.isReady())
                  return false;
                if (n2.DIFFUSE = true, !this._diffuseTexture2 || !this._diffuseTexture2.isReady())
                  return false;
                if (!this._diffuseTexture3 || !this._diffuseTexture3.isReady())
                  return false;
                if (!this._diffuseTexture4 || !this._diffuseTexture4.isReady())
                  return false;
                if (this._mixTexture2) {
                  if (!this._mixTexture2.isReady())
                    return false;
                  if (n2.MIXMAP2 = true, !this._diffuseTexture5 || !this._diffuseTexture5.isReady())
                    return false;
                  if (!this._diffuseTexture6 || !this._diffuseTexture6.isReady())
                    return false;
                  if (!this._diffuseTexture7 || !this._diffuseTexture7.isReady())
                    return false;
                  if (!this._diffuseTexture8 || !this._diffuseTexture8.isReady())
                    return false;
                }
              }
            }
            if (r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), n2), n2._needNormals = r.MaterialHelper.PrepareDefinesForLights(o2, e4, n2, false, this._maxSimultaneousLights, this._disableLighting), r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, true, true), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var f2 = new r.EffectFallbacks();
              n2.FOG && f2.addFallback(1, "FOG"), r.MaterialHelper.HandleFallbacksForShadows(n2, f2, this.maxSimultaneousLights), n2.NUM_BONE_INFLUENCERS > 0 && f2.addCPUSkinningFallback(0, e4), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var l = [r.VertexBuffer.PositionKind];
              n2.NORMAL && l.push(r.VertexBuffer.NormalKind), n2.UV1 && l.push(r.VertexBuffer.UVKind), n2.UV2 && l.push(r.VertexBuffer.UV2Kind), n2.VERTEXCOLOR && l.push(r.VertexBuffer.ColorKind), r.MaterialHelper.PrepareAttributesForBones(l, e4, n2, f2), r.MaterialHelper.PrepareAttributesForInstances(l, n2);
              var u = n2.toString(), c = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vDiffuseColor", "vSpecularColor", "vFogInfos", "vFogColor", "pointSize", "vTextureInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "textureMatrix", "diffuse1Infos", "diffuse2Infos", "diffuse3Infos", "diffuse4Infos", "diffuse5Infos", "diffuse6Infos", "diffuse7Infos", "diffuse8Infos"], d = ["mixMap1Sampler", "mixMap2Sampler", "diffuse1Sampler", "diffuse2Sampler", "diffuse3Sampler", "diffuse4Sampler", "diffuse5Sampler", "diffuse6Sampler", "diffuse7Sampler", "diffuse8Sampler"], p = new Array();
              r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: n2, maxSimultaneousLights: this.maxSimultaneousLights }), t3.setEffect(o2.getEngine().createEffect("mix", { attributes: l, uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: u, fallbacks: f2, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights } }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              a2 && (this._activeEffect = a2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), this._mustRebind(n2, a2) && (this._mixTexture1 && (this._activeEffect.setTexture("mixMap1Sampler", this._mixTexture1), this._activeEffect.setFloat2("vTextureInfos", this._mixTexture1.coordinatesIndex, this._mixTexture1.level), this._activeEffect.setMatrix("textureMatrix", this._mixTexture1.getTextureMatrix()), r.MaterialFlags.DiffuseTextureEnabled && (this._diffuseTexture1 && (this._activeEffect.setTexture("diffuse1Sampler", this._diffuseTexture1), this._activeEffect.setFloat2("diffuse1Infos", this._diffuseTexture1.uScale, this._diffuseTexture1.vScale)), this._diffuseTexture2 && (this._activeEffect.setTexture("diffuse2Sampler", this._diffuseTexture2), this._activeEffect.setFloat2("diffuse2Infos", this._diffuseTexture2.uScale, this._diffuseTexture2.vScale)), this._diffuseTexture3 && (this._activeEffect.setTexture("diffuse3Sampler", this._diffuseTexture3), this._activeEffect.setFloat2("diffuse3Infos", this._diffuseTexture3.uScale, this._diffuseTexture3.vScale)), this._diffuseTexture4 && (this._activeEffect.setTexture("diffuse4Sampler", this._diffuseTexture4), this._activeEffect.setFloat2("diffuse4Infos", this._diffuseTexture4.uScale, this._diffuseTexture4.vScale)))), this._mixTexture2 && (this._activeEffect.setTexture("mixMap2Sampler", this._mixTexture2), r.MaterialFlags.DiffuseTextureEnabled && (this._diffuseTexture5 && (this._activeEffect.setTexture("diffuse5Sampler", this._diffuseTexture5), this._activeEffect.setFloat2("diffuse5Infos", this._diffuseTexture5.uScale, this._diffuseTexture5.vScale)), this._diffuseTexture6 && (this._activeEffect.setTexture("diffuse6Sampler", this._diffuseTexture6), this._activeEffect.setFloat2("diffuse6Infos", this._diffuseTexture6.uScale, this._diffuseTexture6.vScale)), this._diffuseTexture7 && (this._activeEffect.setTexture("diffuse7Sampler", this._diffuseTexture7), this._activeEffect.setFloat2("diffuse7Infos", this._diffuseTexture7.uScale, this._diffuseTexture7.vScale)), this._diffuseTexture8 && (this._activeEffect.setTexture("diffuse8Sampler", this._diffuseTexture8), this._activeEffect.setFloat2("diffuse8Infos", this._diffuseTexture8.uScale, this._diffuseTexture8.vScale)))), r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(a2, n2)), this._activeEffect.setColor4("vDiffuseColor", this.diffuseColor, this.alpha * t3.visibility), o2.SPECULARTERM && this._activeEffect.setColor4("vSpecularColor", this.specularColor, this.specularPower), n2.lightsEnabled && !this.disableLighting && r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2, this.maxSimultaneousLights), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.getAnimatables = function() {
            var e4 = [];
            return this._mixTexture1 && this._mixTexture1.animations && this._mixTexture1.animations.length > 0 && e4.push(this._mixTexture1), this._mixTexture2 && this._mixTexture2.animations && this._mixTexture2.animations.length > 0 && e4.push(this._mixTexture2), e4;
          }, t2.prototype.getActiveTextures = function() {
            var t3 = e3.prototype.getActiveTextures.call(this);
            return this._mixTexture1 && t3.push(this._mixTexture1), this._diffuseTexture1 && t3.push(this._diffuseTexture1), this._diffuseTexture2 && t3.push(this._diffuseTexture2), this._diffuseTexture3 && t3.push(this._diffuseTexture3), this._diffuseTexture4 && t3.push(this._diffuseTexture4), this._mixTexture2 && t3.push(this._mixTexture2), this._diffuseTexture5 && t3.push(this._diffuseTexture5), this._diffuseTexture6 && t3.push(this._diffuseTexture6), this._diffuseTexture7 && t3.push(this._diffuseTexture7), this._diffuseTexture8 && t3.push(this._diffuseTexture8), t3;
          }, t2.prototype.hasTexture = function(t3) {
            return !!e3.prototype.hasTexture.call(this, t3) || (this._mixTexture1 === t3 || (this._diffuseTexture1 === t3 || (this._diffuseTexture2 === t3 || (this._diffuseTexture3 === t3 || (this._diffuseTexture4 === t3 || (this._mixTexture2 === t3 || (this._diffuseTexture5 === t3 || (this._diffuseTexture6 === t3 || (this._diffuseTexture7 === t3 || this._diffuseTexture8 === t3)))))))));
          }, t2.prototype.dispose = function(t3) {
            this._mixTexture1 && this._mixTexture1.dispose(), e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.MixMaterial", e4;
          }, t2.prototype.getClassName = function() {
            return "MixMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, Object(n.a)([Object(r.serializeAsTexture)("mixTexture1")], t2.prototype, "_mixTexture1", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "mixTexture1", void 0), Object(n.a)([Object(r.serializeAsTexture)("mixTexture2")], t2.prototype, "_mixTexture2", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "mixTexture2", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture1")], t2.prototype, "_diffuseTexture1", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture1", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture2")], t2.prototype, "_diffuseTexture2", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture2", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture3")], t2.prototype, "_diffuseTexture3", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture3", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture4")], t2.prototype, "_diffuseTexture4", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture4", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture1")], t2.prototype, "_diffuseTexture5", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture5", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture2")], t2.prototype, "_diffuseTexture6", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture6", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture3")], t2.prototype, "_diffuseTexture7", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture7", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture4")], t2.prototype, "_diffuseTexture8", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture8", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "diffuseColor", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "specularColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "specularPower", void 0), Object(n.a)([Object(r.serialize)("disableLighting")], t2.prototype, "_disableLighting", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "disableLighting", void 0), Object(n.a)([Object(r.serialize)("maxSimultaneousLights")], t2.prototype, "_maxSimultaneousLights", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "maxSimultaneousLights", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.MixMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "NormalMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef LIGHTING\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#endif\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef NORMAL\nbaseColor=mix(baseColor,vec4(vNormalW,1.0),0.5);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\n#ifdef LIGHTING\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=baseColor.rgb;\n#endif\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";
        r.Effect.ShadersStore.normalPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";
        r.Effect.ShadersStore.normalVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.DIFFUSE = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.DEPTHPREPASS = false, t3.POINTSIZE = false, t3.FOG = false, t3.LIGHT0 = false, t3.LIGHT1 = false, t3.LIGHT2 = false, t3.LIGHT3 = false, t3.SPOTLIGHT0 = false, t3.SPOTLIGHT1 = false, t3.SPOTLIGHT2 = false, t3.SPOTLIGHT3 = false, t3.HEMILIGHT0 = false, t3.HEMILIGHT1 = false, t3.HEMILIGHT2 = false, t3.HEMILIGHT3 = false, t3.DIRLIGHT0 = false, t3.DIRLIGHT1 = false, t3.DIRLIGHT2 = false, t3.DIRLIGHT3 = false, t3.POINTLIGHT0 = false, t3.POINTLIGHT1 = false, t3.POINTLIGHT2 = false, t3.POINTLIGHT3 = false, t3.SHADOW0 = false, t3.SHADOW1 = false, t3.SHADOW2 = false, t3.SHADOW3 = false, t3.SHADOWS = false, t3.SHADOWESM0 = false, t3.SHADOWESM1 = false, t3.SHADOWESM2 = false, t3.SHADOWESM3 = false, t3.SHADOWPOISSON0 = false, t3.SHADOWPOISSON1 = false, t3.SHADOWPOISSON2 = false, t3.SHADOWPOISSON3 = false, t3.SHADOWPCF0 = false, t3.SHADOWPCF1 = false, t3.SHADOWPCF2 = false, t3.SHADOWPCF3 = false, t3.SHADOWPCSS0 = false, t3.SHADOWPCSS1 = false, t3.SHADOWPCSS2 = false, t3.SHADOWPCSS3 = false, t3.NORMAL = false, t3.UV1 = false, t3.UV2 = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.LIGHTING = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.diffuseColor = new r.Color3(1, 1, 1), n2._disableLighting = false, n2._maxSimultaneousLights = 4, n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1;
          }, t2.prototype.needAlphaBlendingForMesh = function(e4) {
            return this.needAlphaBlending() || e4.visibility < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (n2._areTexturesDirty && (n2._needUVs = false, o2.texturesEnabled && this._diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled)) {
              if (!this._diffuseTexture.isReady())
                return false;
              n2._needUVs = true, n2.DIFFUSE = true;
            }
            if (r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), n2), n2._needNormals = true, r.MaterialHelper.PrepareDefinesForLights(o2, e4, n2, false, this._maxSimultaneousLights, this._disableLighting), r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), n2.LIGHTING = !this._disableLighting, r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, true, true), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var f2 = new r.EffectFallbacks();
              n2.FOG && f2.addFallback(1, "FOG"), r.MaterialHelper.HandleFallbacksForShadows(n2, f2), n2.NUM_BONE_INFLUENCERS > 0 && f2.addCPUSkinningFallback(0, e4), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var l = [r.VertexBuffer.PositionKind];
              n2.NORMAL && l.push(r.VertexBuffer.NormalKind), n2.UV1 && l.push(r.VertexBuffer.UVKind), n2.UV2 && l.push(r.VertexBuffer.UV2Kind), r.MaterialHelper.PrepareAttributesForBones(l, e4, n2, f2), r.MaterialHelper.PrepareAttributesForInstances(l, n2);
              var u = n2.toString(), c = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vDiffuseColor", "vFogInfos", "vFogColor", "pointSize", "vDiffuseInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "diffuseMatrix"], d = ["diffuseSampler"], p = new Array();
              r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: n2, maxSimultaneousLights: 4 }), t3.setEffect(o2.getEngine().createEffect("normal", { attributes: l, uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: u, fallbacks: f2, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: 4 } }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              a2 && (this._activeEffect = a2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), this._mustRebind(n2, a2) && (this.diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled && (this._activeEffect.setTexture("diffuseSampler", this.diffuseTexture), this._activeEffect.setFloat2("vDiffuseInfos", this.diffuseTexture.coordinatesIndex, this.diffuseTexture.level), this._activeEffect.setMatrix("diffuseMatrix", this.diffuseTexture.getTextureMatrix())), r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(a2, n2)), this._activeEffect.setColor4("vDiffuseColor", this.diffuseColor, this.alpha * t3.visibility), n2.lightsEnabled && !this.disableLighting && r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.getAnimatables = function() {
            var e4 = [];
            return this.diffuseTexture && this.diffuseTexture.animations && this.diffuseTexture.animations.length > 0 && e4.push(this.diffuseTexture), e4;
          }, t2.prototype.getActiveTextures = function() {
            var t3 = e3.prototype.getActiveTextures.call(this);
            return this._diffuseTexture && t3.push(this._diffuseTexture), t3;
          }, t2.prototype.hasTexture = function(t3) {
            return !!e3.prototype.hasTexture.call(this, t3) || this.diffuseTexture === t3;
          }, t2.prototype.dispose = function(t3) {
            this.diffuseTexture && this.diffuseTexture.dispose(), e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.NormalMaterial", e4;
          }, t2.prototype.getClassName = function() {
            return "NormalMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture")], t2.prototype, "_diffuseTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "diffuseColor", void 0), Object(n.a)([Object(r.serialize)("disableLighting")], t2.prototype, "_disableLighting", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "disableLighting", void 0), Object(n.a)([Object(r.serialize)("maxSimultaneousLights")], t2.prototype, "_maxSimultaneousLights", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "maxSimultaneousLights", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.NormalMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "ShadowOnlyMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\nuniform float alpha;\nuniform vec3 shadowColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0..1]\n\nvec4 color=vec4(shadowColor,(1.0-clamp(shadow,0.,1.))*alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";
        r.Effect.ShadersStore.shadowOnlyPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";
        r.Effect.ShadersStore.shadowOnlyVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.POINTSIZE = false, t3.FOG = false, t3.NORMAL = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2._needAlphaBlending = true, n2.shadowColor = r.Color3.Black(), n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this._needAlphaBlending;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, Object.defineProperty(t2.prototype, "activeLight", { get: function() {
            return this._activeLight;
          }, set: function(e4) {
            this._activeLight = e4;
          }, enumerable: false, configurable: true }), t2.prototype._getFirstShadowLightForMesh = function(e4) {
            for (var t3 = 0, i2 = e4.lightSources; t3 < i2.length; t3++) {
              var n2 = i2[t3];
              if (n2.shadowEnabled)
                return n2;
            }
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            var n2;
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var o2 = t3._materialDefines, a2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var f2 = a2.getEngine();
            if (this._activeLight)
              for (var l = 0, u = e4.lightSources; l < u.length; l++) {
                var c = u[l];
                if (c.shadowEnabled) {
                  if (this._activeLight === c)
                    break;
                  var d = e4.lightSources.indexOf(this._activeLight);
                  d !== -1 && (e4.lightSources.splice(d, 1), e4.lightSources.splice(0, 0, this._activeLight));
                  break;
                }
              }
            r.MaterialHelper.PrepareDefinesForFrameBoundValues(a2, f2, o2, !!i2), r.MaterialHelper.PrepareDefinesForMisc(e4, a2, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), o2), o2._needNormals = r.MaterialHelper.PrepareDefinesForLights(a2, e4, o2, false, 1);
            var p = (n2 = this._getFirstShadowLightForMesh(e4)) === null || n2 === void 0 ? void 0 : n2.getShadowGenerator();
            if (this._needAlphaBlending = true, p && p.getClassName && p.getClassName() === "CascadedShadowGenerator") {
              var h = p;
              this._needAlphaBlending = !h.autoCalcDepthBounds;
            }
            if (r.MaterialHelper.PrepareDefinesForAttributes(e4, o2, false, true), o2.isDirty) {
              o2.markAsProcessed(), a2.resetCachedMaterial();
              var v = new r.EffectFallbacks();
              o2.FOG && v.addFallback(1, "FOG"), r.MaterialHelper.HandleFallbacksForShadows(o2, v, 1), o2.NUM_BONE_INFLUENCERS > 0 && v.addCPUSkinningFallback(0, e4), o2.IMAGEPROCESSINGPOSTPROCESS = a2.imageProcessingConfiguration.applyByPostProcess;
              var m = [r.VertexBuffer.PositionKind];
              o2.NORMAL && m.push(r.VertexBuffer.NormalKind), r.MaterialHelper.PrepareAttributesForBones(m, e4, o2, v), r.MaterialHelper.PrepareAttributesForInstances(m, o2);
              var g = o2.toString(), x = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vFogInfos", "vFogColor", "pointSize", "alpha", "shadowColor", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6"], T = new Array(), _ = new Array();
              r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: x, uniformBuffersNames: _, samplers: T, defines: o2, maxSimultaneousLights: 1 }), t3.setEffect(a2.getEngine().createEffect("shadowOnly", { attributes: m, uniformsNames: x, uniformBuffersNames: _, samplers: T, defines: g, fallbacks: v, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: 1 } }, f2), o2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (o2._renderId = a2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              if (a2) {
                if (this._activeEffect = a2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), this._mustRebind(n2, a2) && (r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), this._activeEffect.setFloat("alpha", this.alpha), this._activeEffect.setColor3("shadowColor", this.shadowColor), r.MaterialHelper.BindEyePosition(a2, n2)), n2.lightsEnabled) {
                  r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2, 1);
                  var s2 = this._getFirstShadowLightForMesh(t3);
                  s2 && (s2._renderId = -1);
                }
                (n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE || o2.SHADOWCSM0) && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._afterBind(t3, this._activeEffect);
              }
            }
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.ShadowOnlyMaterial", e4;
          }, t2.prototype.getClassName = function() {
            return "ShadowOnlyMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.ShadowOnlyMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "SimpleMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";
        r.Effect.ShadersStore.simplePixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";
        r.Effect.ShadersStore.simpleVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.DIFFUSE = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.DEPTHPREPASS = false, t3.POINTSIZE = false, t3.FOG = false, t3.NORMAL = false, t3.UV1 = false, t3.UV2 = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.diffuseColor = new r.Color3(1, 1, 1), n2._disableLighting = false, n2._maxSimultaneousLights = 4, n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (n2._areTexturesDirty && (n2._needUVs = false, o2.texturesEnabled && this._diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled)) {
              if (!this._diffuseTexture.isReady())
                return false;
              n2._needUVs = true, n2.DIFFUSE = true;
            }
            if (r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), n2), n2._needNormals = r.MaterialHelper.PrepareDefinesForLights(o2, e4, n2, false, this._maxSimultaneousLights, this._disableLighting), r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, true, true), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var f2 = new r.EffectFallbacks();
              n2.FOG && f2.addFallback(1, "FOG"), r.MaterialHelper.HandleFallbacksForShadows(n2, f2, this.maxSimultaneousLights), n2.NUM_BONE_INFLUENCERS > 0 && f2.addCPUSkinningFallback(0, e4), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var l = [r.VertexBuffer.PositionKind];
              n2.NORMAL && l.push(r.VertexBuffer.NormalKind), n2.UV1 && l.push(r.VertexBuffer.UVKind), n2.UV2 && l.push(r.VertexBuffer.UV2Kind), n2.VERTEXCOLOR && l.push(r.VertexBuffer.ColorKind), r.MaterialHelper.PrepareAttributesForBones(l, e4, n2, f2), r.MaterialHelper.PrepareAttributesForInstances(l, n2);
              var u = n2.toString(), c = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vDiffuseColor", "vFogInfos", "vFogColor", "pointSize", "vDiffuseInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "diffuseMatrix"], d = ["diffuseSampler"], p = new Array();
              r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: n2, maxSimultaneousLights: this.maxSimultaneousLights }), t3.setEffect(o2.getEngine().createEffect("simple", { attributes: l, uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: u, fallbacks: f2, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: this._maxSimultaneousLights - 1 } }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              a2 && (this._activeEffect = a2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), this._mustRebind(n2, a2) && (this._diffuseTexture && r.MaterialFlags.DiffuseTextureEnabled && (this._activeEffect.setTexture("diffuseSampler", this._diffuseTexture), this._activeEffect.setFloat2("vDiffuseInfos", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level), this._activeEffect.setMatrix("diffuseMatrix", this._diffuseTexture.getTextureMatrix())), r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(a2, n2)), this._activeEffect.setColor4("vDiffuseColor", this.diffuseColor, this.alpha * t3.visibility), n2.lightsEnabled && !this.disableLighting && r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2, this.maxSimultaneousLights), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.getAnimatables = function() {
            var e4 = [];
            return this._diffuseTexture && this._diffuseTexture.animations && this._diffuseTexture.animations.length > 0 && e4.push(this._diffuseTexture), e4;
          }, t2.prototype.getActiveTextures = function() {
            var t3 = e3.prototype.getActiveTextures.call(this);
            return this._diffuseTexture && t3.push(this._diffuseTexture), t3;
          }, t2.prototype.hasTexture = function(t3) {
            return !!e3.prototype.hasTexture.call(this, t3) || this.diffuseTexture === t3;
          }, t2.prototype.dispose = function(t3) {
            this._diffuseTexture && this._diffuseTexture.dispose(), e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.SimpleMaterial", e4;
          }, t2.prototype.getClassName = function() {
            return "SimpleMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture")], t2.prototype, "_diffuseTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture", void 0), Object(n.a)([Object(r.serializeAsColor3)("diffuse")], t2.prototype, "diffuseColor", void 0), Object(n.a)([Object(r.serialize)("disableLighting")], t2.prototype, "_disableLighting", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "disableLighting", void 0), Object(n.a)([Object(r.serialize)("maxSimultaneousLights")], t2.prototype, "_maxSimultaneousLights", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "maxSimultaneousLights", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.SimpleMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "SkyMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\nuniform vec3 cameraPosition;\nuniform vec3 cameraOffset;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n\n#include<fogFragmentDeclaration>\n\nconst float e=2.71828182845904523536028747135266249775724709369995957;\nconst float pi=3.141592653589793238462643383279502884197169;\nconst float n=1.0003;\nconst float N=2.545E25;\nconst float pn=0.035;\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\nconst vec3 K=vec3(0.686,0.678,0.666);\nconst float v=4.0;\nconst float rayleighZenithLength=8.4E3;\nconst float mieZenithLength=1.25E3;\nconst vec3 up=vec3(0.0,1.0,0.0);\nconst float EE=1000.0;\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle=pi/1.95;\nconst float steepness=1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005/vec3(94,40,18);\n}\nfloat rayleighPhase(float cosTheta)\n{\nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\n}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{\nfloat c=(0.2*T )*10E-18;\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\n}\nfloat hgPhase(float cosTheta,float g)\n{\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\n}\nfloat A=0.15;\nfloat B=0.50;\nfloat C=0.10;\nfloat D=0.20;\nfloat EEE=0.02;\nfloat F=0.30;\nfloat W=1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\n\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\nvec3 sunDirection=normalize(sunPosition);\nfloat sunE=sunIntensity(dot(sunDirection,up));\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta=betaR*rPhase;\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\nvec3 betaMTheta=betaM*mPhase;\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\nvec3 direction=normalize(vPositionW-cameraPosition);\nfloat theta=acos(direction.y);\nfloat phi=atan(direction.z,direction.x);\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\nvec3 L0=vec3(0.1)*Fex;\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0+=(sunE*19000.0*Fex)*sundisk;\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor=(Lin+L0);\ntexColor*=0.04 ;\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance=1.0;\nfloat fLumScaled=0.1/luminance;\nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled);\nfloat ExposureBias=fLumCompressed;\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\n\n\n\nvec3 retColor=curr*whiteScale;\n\n\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}\n";
        r.Effect.ShadersStore.skyPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\nvoid main(void) {\ngl_Position=viewProjection*world*vec4(position,1.0);\nvec4 worldPos=world*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";
        r.Effect.ShadersStore.skyVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.POINTSIZE = false, t3.FOG = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.luminance = 1, n2.turbidity = 10, n2.rayleigh = 2, n2.mieCoefficient = 5e-3, n2.mieDirectionalG = 0.8, n2.distance = 500, n2.inclination = 0.49, n2.azimuth = 0.25, n2.sunPosition = new r.Vector3(0, 100, 0), n2.useSunPosition = false, n2.cameraOffset = r.Vector3.Zero(), n2._cameraPosition = r.Vector3.Zero(), n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            if (r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, this.pointsCloud, this.fogEnabled, false, n2), r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, true, false), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var a2 = new r.EffectFallbacks();
              n2.FOG && a2.addFallback(1, "FOG"), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var f2 = [r.VertexBuffer.PositionKind];
              n2.VERTEXCOLOR && f2.push(r.VertexBuffer.ColorKind);
              var l = n2.toString();
              t3.setEffect(o2.getEngine().createEffect("sky", f2, ["world", "viewProjection", "view", "vFogInfos", "vFogColor", "pointSize", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "luminance", "turbidity", "rayleigh", "mieCoefficient", "mieDirectionalG", "sunPosition", "cameraPosition", "cameraOffset"], [], l, a2, this.onCompiled, this.onError), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene();
            if (i2._materialDefines) {
              var o2 = i2.effect;
              if (o2) {
                this._activeEffect = o2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), this._mustRebind(n2, o2) && (r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize)), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect);
                var a2 = n2.activeCamera;
                if (a2) {
                  var s2 = a2.getWorldMatrix();
                  this._cameraPosition.x = s2.m[12], this._cameraPosition.y = s2.m[13], this._cameraPosition.z = s2.m[14], this._activeEffect.setVector3("cameraPosition", this._cameraPosition);
                }
                if (this._activeEffect.setVector3("cameraOffset", this.cameraOffset), this.luminance > 0 && this._activeEffect.setFloat("luminance", this.luminance), this._activeEffect.setFloat("turbidity", this.turbidity), this._activeEffect.setFloat("rayleigh", this.rayleigh), this._activeEffect.setFloat("mieCoefficient", this.mieCoefficient), this._activeEffect.setFloat("mieDirectionalG", this.mieDirectionalG), !this.useSunPosition) {
                  var f2 = Math.PI * (this.inclination - 0.5), l = 2 * Math.PI * (this.azimuth - 0.5);
                  this.sunPosition.x = this.distance * Math.cos(l), this.sunPosition.y = this.distance * Math.sin(l) * Math.sin(f2), this.sunPosition.z = this.distance * Math.sin(l) * Math.cos(f2);
                }
                this._activeEffect.setVector3("sunPosition", this.sunPosition), this._afterBind(t3, this._activeEffect);
              }
            }
          }, t2.prototype.getAnimatables = function() {
            return [];
          }, t2.prototype.dispose = function(t3) {
            e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.SkyMaterial", e4;
          }, t2.prototype.getClassName = function() {
            return "SkyMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, Object(n.a)([Object(r.serialize)()], t2.prototype, "luminance", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "turbidity", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "rayleigh", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "mieCoefficient", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "mieDirectionalG", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "distance", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "inclination", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "azimuth", void 0), Object(n.a)([Object(r.serializeAsVector3)()], t2.prototype, "sunPosition", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "useSunPosition", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "cameraOffset", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.SkyMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "TerrainMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform sampler2D textureSampler;\nuniform vec2 vTextureInfos;\nuniform sampler2D diffuse1Sampler;\nuniform sampler2D diffuse2Sampler;\nuniform sampler2D diffuse3Sampler;\nuniform vec2 diffuse1Infos;\nuniform vec2 diffuse2Infos;\nuniform vec2 diffuse3Infos;\n#endif\n#ifdef BUMP\nuniform sampler2D bump1Sampler;\nuniform sampler2D bump2Sampler;\nuniform sampler2D bump3Sampler;\n#endif\n\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n\n#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,vec3 mixColor)\n{\nvec3 bump1Color=texture2D(bump1Sampler,vTextureUV*diffuse1Infos).xyz;\nvec3 bump2Color=texture2D(bump2Sampler,vTextureUV*diffuse2Infos).xyz;\nvec3 bump3Color=texture2D(bump3Sampler,vTextureUV*diffuse3Infos).xyz;\nbump1Color.rgb*=mixColor.r;\nbump2Color.rgb=mix(bump1Color.rgb,bump2Color.rgb,mixColor.g);\nvec3 map=mix(bump2Color.rgb,bump3Color.rgb,mixColor.b);\nmap=map*255./127.-128./127.;\nmat3 TBN=cotangent_frame(vNormalW*vTextureInfos.y,-viewDir,vTextureUV);\nreturn normalize(TBN*map);\n}\n#endif\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(textureSampler,vTextureUV);\n#if defined(BUMP) && defined(DIFFUSE)\nnormalW=perturbNormal(viewDirectionW,baseColor.rgb);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vTextureInfos.y;\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\ndiffuse1Color.rgb*=baseColor.r;\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,baseColor.g);\nbaseColor.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,baseColor.b);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*baseColor.rgb,0.0,1.0);\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}\n";
        r.Effect.ShadersStore.terrainPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform mat4 textureMatrix;\nuniform vec2 vTextureInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vTextureInfos.x == 0.)\n{\nvTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";
        r.Effect.ShadersStore.terrainVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.DIFFUSE = false, t3.BUMP = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.DEPTHPREPASS = false, t3.POINTSIZE = false, t3.FOG = false, t3.SPECULARTERM = false, t3.NORMAL = false, t3.UV1 = false, t3.UV2 = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.diffuseColor = new r.Color3(1, 1, 1), n2.specularColor = new r.Color3(0, 0, 0), n2.specularPower = 64, n2._disableLighting = false, n2._maxSimultaneousLights = 4, n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (o2.texturesEnabled) {
              if (!this.mixTexture || !this.mixTexture.isReady())
                return false;
              if (n2._needUVs = true, r.MaterialFlags.DiffuseTextureEnabled) {
                if (!this.diffuseTexture1 || !this.diffuseTexture1.isReady())
                  return false;
                if (!this.diffuseTexture2 || !this.diffuseTexture2.isReady())
                  return false;
                if (!this.diffuseTexture3 || !this.diffuseTexture3.isReady())
                  return false;
                n2.DIFFUSE = true;
              }
              if (this.bumpTexture1 && this.bumpTexture2 && this.bumpTexture3 && r.MaterialFlags.BumpTextureEnabled) {
                if (!this.bumpTexture1.isReady())
                  return false;
                if (!this.bumpTexture2.isReady())
                  return false;
                if (!this.bumpTexture3.isReady())
                  return false;
                n2._needNormals = true, n2.BUMP = true;
              }
            }
            if (r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), n2), n2._needNormals = r.MaterialHelper.PrepareDefinesForLights(o2, e4, n2, false, this._maxSimultaneousLights, this._disableLighting), r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, true, true), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var f2 = new r.EffectFallbacks();
              n2.FOG && f2.addFallback(1, "FOG"), r.MaterialHelper.HandleFallbacksForShadows(n2, f2, this.maxSimultaneousLights), n2.NUM_BONE_INFLUENCERS > 0 && f2.addCPUSkinningFallback(0, e4), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var l = [r.VertexBuffer.PositionKind];
              n2.NORMAL && l.push(r.VertexBuffer.NormalKind), n2.UV1 && l.push(r.VertexBuffer.UVKind), n2.UV2 && l.push(r.VertexBuffer.UV2Kind), n2.VERTEXCOLOR && l.push(r.VertexBuffer.ColorKind), r.MaterialHelper.PrepareAttributesForBones(l, e4, n2, f2), r.MaterialHelper.PrepareAttributesForInstances(l, n2);
              var u = n2.toString(), c = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vDiffuseColor", "vSpecularColor", "vFogInfos", "vFogColor", "pointSize", "vTextureInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "textureMatrix", "diffuse1Infos", "diffuse2Infos", "diffuse3Infos"], d = ["textureSampler", "diffuse1Sampler", "diffuse2Sampler", "diffuse3Sampler", "bump1Sampler", "bump2Sampler", "bump3Sampler"], p = new Array();
              r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: n2, maxSimultaneousLights: this.maxSimultaneousLights }), t3.setEffect(o2.getEngine().createEffect("terrain", { attributes: l, uniformsNames: c, uniformBuffersNames: p, samplers: d, defines: u, fallbacks: f2, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights } }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              a2 && (this._activeEffect = a2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), this._mustRebind(n2, a2) && (this.mixTexture && (this._activeEffect.setTexture("textureSampler", this._mixTexture), this._activeEffect.setFloat2("vTextureInfos", this._mixTexture.coordinatesIndex, this._mixTexture.level), this._activeEffect.setMatrix("textureMatrix", this._mixTexture.getTextureMatrix()), r.MaterialFlags.DiffuseTextureEnabled && (this._diffuseTexture1 && (this._activeEffect.setTexture("diffuse1Sampler", this._diffuseTexture1), this._activeEffect.setFloat2("diffuse1Infos", this._diffuseTexture1.uScale, this._diffuseTexture1.vScale)), this._diffuseTexture2 && (this._activeEffect.setTexture("diffuse2Sampler", this._diffuseTexture2), this._activeEffect.setFloat2("diffuse2Infos", this._diffuseTexture2.uScale, this._diffuseTexture2.vScale)), this._diffuseTexture3 && (this._activeEffect.setTexture("diffuse3Sampler", this._diffuseTexture3), this._activeEffect.setFloat2("diffuse3Infos", this._diffuseTexture3.uScale, this._diffuseTexture3.vScale))), r.MaterialFlags.BumpTextureEnabled && n2.getEngine().getCaps().standardDerivatives && (this._bumpTexture1 && this._activeEffect.setTexture("bump1Sampler", this._bumpTexture1), this._bumpTexture2 && this._activeEffect.setTexture("bump2Sampler", this._bumpTexture2), this._bumpTexture3 && this._activeEffect.setTexture("bump3Sampler", this._bumpTexture3))), r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(a2, n2)), this._activeEffect.setColor4("vDiffuseColor", this.diffuseColor, this.alpha * t3.visibility), o2.SPECULARTERM && this._activeEffect.setColor4("vSpecularColor", this.specularColor, this.specularPower), n2.lightsEnabled && !this.disableLighting && r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2, this.maxSimultaneousLights), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.getAnimatables = function() {
            var e4 = [];
            return this.mixTexture && this.mixTexture.animations && this.mixTexture.animations.length > 0 && e4.push(this.mixTexture), e4;
          }, t2.prototype.getActiveTextures = function() {
            var t3 = e3.prototype.getActiveTextures.call(this);
            return this._mixTexture && t3.push(this._mixTexture), this._diffuseTexture1 && t3.push(this._diffuseTexture1), this._diffuseTexture2 && t3.push(this._diffuseTexture2), this._diffuseTexture3 && t3.push(this._diffuseTexture3), this._bumpTexture1 && t3.push(this._bumpTexture1), this._bumpTexture2 && t3.push(this._bumpTexture2), this._bumpTexture3 && t3.push(this._bumpTexture3), t3;
          }, t2.prototype.hasTexture = function(t3) {
            return !!e3.prototype.hasTexture.call(this, t3) || (this._mixTexture === t3 || (this._diffuseTexture1 === t3 || (this._diffuseTexture2 === t3 || (this._diffuseTexture3 === t3 || (this._bumpTexture1 === t3 || (this._bumpTexture2 === t3 || this._bumpTexture3 === t3))))));
          }, t2.prototype.dispose = function(t3) {
            this.mixTexture && this.mixTexture.dispose(), e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.TerrainMaterial", e4;
          }, t2.prototype.getClassName = function() {
            return "TerrainMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, Object(n.a)([Object(r.serializeAsTexture)("mixTexture")], t2.prototype, "_mixTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "mixTexture", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture1")], t2.prototype, "_diffuseTexture1", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture1", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture2")], t2.prototype, "_diffuseTexture2", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture2", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexture3")], t2.prototype, "_diffuseTexture3", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTexture3", void 0), Object(n.a)([Object(r.serializeAsTexture)("bumpTexture1")], t2.prototype, "_bumpTexture1", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "bumpTexture1", void 0), Object(n.a)([Object(r.serializeAsTexture)("bumpTexture2")], t2.prototype, "_bumpTexture2", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "bumpTexture2", void 0), Object(n.a)([Object(r.serializeAsTexture)("bumpTexture3")], t2.prototype, "_bumpTexture3", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "bumpTexture3", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "diffuseColor", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "specularColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "specularPower", void 0), Object(n.a)([Object(r.serialize)("disableLighting")], t2.prototype, "_disableLighting", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "disableLighting", void 0), Object(n.a)([Object(r.serialize)("maxSimultaneousLights")], t2.prototype, "_maxSimultaneousLights", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "maxSimultaneousLights", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.TerrainMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "TriPlanarMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSEX\nvarying vec2 vTextureUVX;\nuniform sampler2D diffuseSamplerX;\n#ifdef BUMPX\nuniform sampler2D normalSamplerX;\n#endif\n#endif\n#ifdef DIFFUSEY\nvarying vec2 vTextureUVY;\nuniform sampler2D diffuseSamplerY;\n#ifdef BUMPY\nuniform sampler2D normalSamplerY;\n#endif\n#endif\n#ifdef DIFFUSEZ\nvarying vec2 vTextureUVZ;\nuniform sampler2D diffuseSamplerZ;\n#ifdef BUMPZ\nuniform sampler2D normalSamplerZ;\n#endif\n#endif\n#ifdef NORMAL\nvarying mat3 tangentSpace;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(0.,0.,0.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=tangentSpace[2];\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\nvec4 baseNormal=vec4(0.0,0.0,0.0,1.0);\nnormalW*=normalW;\n#ifdef DIFFUSEX\nbaseColor+=texture2D(diffuseSamplerX,vTextureUVX)*normalW.x;\n#ifdef BUMPX\nbaseNormal+=texture2D(normalSamplerX,vTextureUVX)*normalW.x;\n#endif\n#endif\n#ifdef DIFFUSEY\nbaseColor+=texture2D(diffuseSamplerY,vTextureUVY)*normalW.y;\n#ifdef BUMPY\nbaseNormal+=texture2D(normalSamplerY,vTextureUVY)*normalW.y;\n#endif\n#endif\n#ifdef DIFFUSEZ\nbaseColor+=texture2D(diffuseSamplerZ,vTextureUVZ)*normalW.z;\n#ifdef BUMPZ\nbaseNormal+=texture2D(normalSamplerZ,vTextureUVZ)*normalW.z;\n#endif\n#endif\n#ifdef NORMAL\nnormalW=normalize((2.0*baseNormal.xyz-1.0)*tangentSpace);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}\n";
        r.Effect.ShadersStore.triplanarPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSEX\nvarying vec2 vTextureUVX;\n#endif\n#ifdef DIFFUSEY\nvarying vec2 vTextureUVY;\n#endif\n#ifdef DIFFUSEZ\nvarying vec2 vTextureUVZ;\n#endif\nuniform float tileSize;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying mat3 tangentSpace;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef DIFFUSEX\nvTextureUVX=worldPos.zy/tileSize;\n#endif\n#ifdef DIFFUSEY\nvTextureUVY=worldPos.xz/tileSize;\n#endif\n#ifdef DIFFUSEZ\nvTextureUVZ=worldPos.xy/tileSize;\n#endif\n#ifdef NORMAL\n\nvec3 xtan=vec3(0,0,1);\nvec3 xbin=vec3(0,1,0);\nvec3 ytan=vec3(1,0,0);\nvec3 ybin=vec3(0,0,1);\nvec3 ztan=vec3(1,0,0);\nvec3 zbin=vec3(0,1,0);\nvec3 normalizedNormal=normalize(normal);\nnormalizedNormal*=normalizedNormal;\nvec3 worldBinormal=normalize(xbin*normalizedNormal.x+ybin*normalizedNormal.y+zbin*normalizedNormal.z);\nvec3 worldTangent=normalize(xtan*normalizedNormal.x+ytan*normalizedNormal.y+ztan*normalizedNormal.z);\nworldTangent=(world*vec4(worldTangent,1.0)).xyz;\nworldBinormal=(world*vec4(worldBinormal,1.0)).xyz;\nvec3 worldNormal=(world*vec4(normalize(normal),1.0)).xyz;\ntangentSpace[0]=worldTangent;\ntangentSpace[1]=worldBinormal;\ntangentSpace[2]=worldNormal;\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";
        r.Effect.ShadersStore.triplanarVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.DIFFUSEX = false, t3.DIFFUSEY = false, t3.DIFFUSEZ = false, t3.BUMPX = false, t3.BUMPY = false, t3.BUMPZ = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.DEPTHPREPASS = false, t3.POINTSIZE = false, t3.FOG = false, t3.SPECULARTERM = false, t3.NORMAL = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.tileSize = 1, n2.diffuseColor = new r.Color3(1, 1, 1), n2.specularColor = new r.Color3(0.2, 0.2, 0.2), n2.specularPower = 64, n2._disableLighting = false, n2._maxSimultaneousLights = 4, n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (n2._areTexturesDirty && o2.texturesEnabled) {
              if (r.MaterialFlags.DiffuseTextureEnabled) {
                for (var f2 = [this.diffuseTextureX, this.diffuseTextureY, this.diffuseTextureZ], l = ["DIFFUSEX", "DIFFUSEY", "DIFFUSEZ"], u = 0; u < f2.length; u++)
                  if (f2[u]) {
                    if (!f2[u].isReady())
                      return false;
                    n2[l[u]] = true;
                  }
              }
              if (r.MaterialFlags.BumpTextureEnabled) {
                for (f2 = [this.normalTextureX, this.normalTextureY, this.normalTextureZ], l = ["BUMPX", "BUMPY", "BUMPZ"], u = 0; u < f2.length; u++)
                  if (f2[u]) {
                    if (!f2[u].isReady())
                      return false;
                    n2[l[u]] = true;
                  }
              }
            }
            if (r.MaterialHelper.PrepareDefinesForMisc(e4, o2, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), n2), n2._needNormals = r.MaterialHelper.PrepareDefinesForLights(o2, e4, n2, false, this._maxSimultaneousLights, this._disableLighting), r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, true, true), n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var c = new r.EffectFallbacks();
              n2.FOG && c.addFallback(1, "FOG"), r.MaterialHelper.HandleFallbacksForShadows(n2, c, this.maxSimultaneousLights), n2.NUM_BONE_INFLUENCERS > 0 && c.addCPUSkinningFallback(0, e4), n2.IMAGEPROCESSINGPOSTPROCESS = o2.imageProcessingConfiguration.applyByPostProcess;
              var d = [r.VertexBuffer.PositionKind];
              n2.NORMAL && d.push(r.VertexBuffer.NormalKind), n2.VERTEXCOLOR && d.push(r.VertexBuffer.ColorKind), r.MaterialHelper.PrepareAttributesForBones(d, e4, n2, c), r.MaterialHelper.PrepareAttributesForInstances(d, n2);
              var p = n2.toString(), h = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vDiffuseColor", "vSpecularColor", "vFogInfos", "vFogColor", "pointSize", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "tileSize"], v = ["diffuseSamplerX", "diffuseSamplerY", "diffuseSamplerZ", "normalSamplerX", "normalSamplerY", "normalSamplerZ"], m = new Array();
              r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: h, uniformBuffersNames: m, samplers: v, defines: n2, maxSimultaneousLights: this.maxSimultaneousLights }), t3.setEffect(o2.getEngine().createEffect("triplanar", { attributes: d, uniformsNames: h, uniformBuffersNames: m, samplers: v, defines: p, fallbacks: c, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights } }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              a2 && (this._activeEffect = a2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), this._activeEffect.setFloat("tileSize", this.tileSize), n2.getCachedMaterial() !== this && (this.diffuseTextureX && this._activeEffect.setTexture("diffuseSamplerX", this.diffuseTextureX), this.diffuseTextureY && this._activeEffect.setTexture("diffuseSamplerY", this.diffuseTextureY), this.diffuseTextureZ && this._activeEffect.setTexture("diffuseSamplerZ", this.diffuseTextureZ), this.normalTextureX && this._activeEffect.setTexture("normalSamplerX", this.normalTextureX), this.normalTextureY && this._activeEffect.setTexture("normalSamplerY", this.normalTextureY), this.normalTextureZ && this._activeEffect.setTexture("normalSamplerZ", this.normalTextureZ), r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(a2, n2)), this._activeEffect.setColor4("vDiffuseColor", this.diffuseColor, this.alpha * t3.visibility), o2.SPECULARTERM && this._activeEffect.setColor4("vSpecularColor", this.specularColor, this.specularPower), n2.lightsEnabled && !this.disableLighting && r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2, this.maxSimultaneousLights), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), this._afterBind(t3, this._activeEffect));
            }
          }, t2.prototype.getAnimatables = function() {
            var e4 = [];
            return this.mixTexture && this.mixTexture.animations && this.mixTexture.animations.length > 0 && e4.push(this.mixTexture), e4;
          }, t2.prototype.getActiveTextures = function() {
            var t3 = e3.prototype.getActiveTextures.call(this);
            return this._diffuseTextureX && t3.push(this._diffuseTextureX), this._diffuseTextureY && t3.push(this._diffuseTextureY), this._diffuseTextureZ && t3.push(this._diffuseTextureZ), this._normalTextureX && t3.push(this._normalTextureX), this._normalTextureY && t3.push(this._normalTextureY), this._normalTextureZ && t3.push(this._normalTextureZ), t3;
          }, t2.prototype.hasTexture = function(t3) {
            return !!e3.prototype.hasTexture.call(this, t3) || (this._diffuseTextureX === t3 || (this._diffuseTextureY === t3 || (this._diffuseTextureZ === t3 || (this._normalTextureX === t3 || (this._normalTextureY === t3 || this._normalTextureZ === t3)))));
          }, t2.prototype.dispose = function(t3) {
            this.mixTexture && this.mixTexture.dispose(), e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            return e4.customType = "BABYLON.TriPlanarMaterial", e4;
          }, t2.prototype.getClassName = function() {
            return "TriPlanarMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            return r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
          }, Object(n.a)([Object(r.serializeAsTexture)()], t2.prototype, "mixTexture", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTextureX")], t2.prototype, "_diffuseTextureX", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTextureX", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTexturY")], t2.prototype, "_diffuseTextureY", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTextureY", void 0), Object(n.a)([Object(r.serializeAsTexture)("diffuseTextureZ")], t2.prototype, "_diffuseTextureZ", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "diffuseTextureZ", void 0), Object(n.a)([Object(r.serializeAsTexture)("normalTextureX")], t2.prototype, "_normalTextureX", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "normalTextureX", void 0), Object(n.a)([Object(r.serializeAsTexture)("normalTextureY")], t2.prototype, "_normalTextureY", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "normalTextureY", void 0), Object(n.a)([Object(r.serializeAsTexture)("normalTextureZ")], t2.prototype, "_normalTextureZ", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "normalTextureZ", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "tileSize", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "diffuseColor", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "specularColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "specularPower", void 0), Object(n.a)([Object(r.serialize)("disableLighting")], t2.prototype, "_disableLighting", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "disableLighting", void 0), Object(n.a)([Object(r.serialize)("maxSimultaneousLights")], t2.prototype, "_maxSimultaneousLights", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "maxSimultaneousLights", void 0), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.TriPlanarMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "WaterMaterial", function() {
          return f;
        });
        var n = i(1), r = i(0), o = "#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef BUMP\nvarying vec2 vNormalUV;\nvarying vec2 vNormalUV2;\nuniform sampler2D normalSampler;\nuniform vec2 vNormalInfos;\n#endif\nuniform sampler2D refractionSampler;\nuniform sampler2D reflectionSampler;\n\nconst float LOG2=1.442695;\nuniform vec3 cameraPosition;\nuniform vec4 waterColor;\nuniform float colorBlendFactor;\nuniform vec4 waterColor2;\nuniform float colorBlendFactor2;\nuniform float bumpHeight;\nuniform float time;\n\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvarying vec3 vPosition;\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef BUMP\n#ifdef BUMPSUPERIMPOSE\nbaseColor=0.6*texture2D(normalSampler,vNormalUV)+0.4*texture2D(normalSampler,vec2(vNormalUV2.x,vNormalUV2.y));\n#else\nbaseColor=texture2D(normalSampler,vNormalUV);\n#endif\nvec3 bumpColor=baseColor.rgb;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vNormalInfos.y;\n#else\nvec3 bumpColor=vec3(1.0);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec2 perturbation=bumpHeight*(baseColor.rg-0.5);\n#ifdef BUMPAFFECTSREFLECTION\nvec3 normalW=normalize(vNormalW+vec3(perturbation.x*8.0,0.0,perturbation.y*8.0));\nif (normalW.y<0.0) {\nnormalW.y=-normalW.y;\n}\n#else\nvec3 normalW=normalize(vNormalW);\n#endif\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\nvec2 perturbation=bumpHeight*(vec2(1.0,1.0)-0.5);\n#endif\n#ifdef FRESNELSEPARATE\n#ifdef REFLECTION\n\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation*0.5,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\n#ifdef IS_REFRACTION_LINEAR\nrefractiveColor.rgb=toGammaSpace(refractiveColor.rgb);\n#endif\nvec2 projectedReflectionTexCoords=clamp(vec2(\nvReflectionMapTexCoord.x/vReflectionMapTexCoord.z+perturbation.x*0.3,\nvReflectionMapTexCoord.y/vReflectionMapTexCoord.z+perturbation.y\n),0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\n#ifdef IS_REFLECTION_LINEAR\nreflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);\n#endif\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=clamp(abs(pow(dot(viewDirectionW,upVector),3.0)),0.05,0.65);\nfloat IfresnelTerm=1.0-fresnelTerm;\nrefractiveColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*refractiveColor;\nreflectiveColor=IfresnelTerm*colorBlendFactor2*waterColor+(1.0-colorBlendFactor2*IfresnelTerm)*reflectiveColor;\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*IfresnelTerm;\nbaseColor=combinedColor;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#else\n#ifdef REFLECTION\n\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\n#ifdef IS_REFRACTION_LINEAR\nrefractiveColor.rgb=toGammaSpace(refractiveColor.rgb);\n#endif\nvec2 projectedReflectionTexCoords=clamp(vReflectionMapTexCoord.xy/vReflectionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\n#ifdef IS_REFLECTION_LINEAR\nreflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);\n#endif\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=max(dot(viewDirectionW,upVector),0.0);\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*(1.0-fresnelTerm);\nbaseColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*combinedColor;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#endif\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#elif defined(IMAGEPROCESSING)\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\ngl_FragColor=color;\n}\n";
        r.Effect.ShadersStore.waterPixelShader = o;
        var a = "precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef BUMP\nvarying vec2 vNormalUV;\n#ifdef BUMPSUPERIMPOSE\nvarying vec2 vNormalUV2;\n#endif\nuniform mat4 normalMatrix;\nuniform vec2 vNormalInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<logDepthDeclaration>\n\nuniform mat4 worldReflectionViewProjection;\nuniform vec2 windDirection;\nuniform float waveLength;\nuniform float time;\nuniform float windForce;\nuniform float waveHeight;\nuniform float waveSpeed;\nuniform float waveCount;\n\nvarying vec3 vPosition;\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef BUMP\nif (vNormalInfos.x == 0.)\n{\nvNormalUV=vec2(normalMatrix*vec4((uv*1.0)/waveLength+time*windForce*windDirection,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv*0.721)/waveLength+time*1.2*windForce*windDirection,1.0,0.0));\n#endif\n}\nelse\n{\nvNormalUV=vec2(normalMatrix*vec4((uv2*1.0)/waveLength+time*windForce*windDirection ,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv2*0.721)/waveLength+time*1.2*windForce*windDirection ,1.0,0.0));\n#endif\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\nfloat finalWaveCount=1.0/(waveCount*0.5);\nvec3 p=position;\nfloat newY=(sin(((p.x/finalWaveCount)+time*waveSpeed))*waveHeight*windDirection.x*5.0)\n+(cos(((p.z/finalWaveCount)+time*waveSpeed))*waveHeight*windDirection.y*5.0);\np.y+=abs(newY);\ngl_Position=viewProjection*finalWorld*vec4(p,1.0);\n#ifdef REFLECTION\nworldPos=viewProjection*finalWorld*vec4(p,1.0);\n\nvPosition=position;\nvRefractionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvRefractionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvRefractionMapTexCoord.z=worldPos.w;\nworldPos=worldReflectionViewProjection*vec4(position,1.0);\nvReflectionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvReflectionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvReflectionMapTexCoord.z=worldPos.w;\n#endif\n#include<logDepthVertex>\n}\n";
        r.Effect.ShadersStore.waterVertexShader = a;
        var s = function(e3) {
          function t2() {
            var t3 = e3.call(this) || this;
            return t3.BUMP = false, t3.REFLECTION = false, t3.CLIPPLANE = false, t3.CLIPPLANE2 = false, t3.CLIPPLANE3 = false, t3.CLIPPLANE4 = false, t3.CLIPPLANE5 = false, t3.CLIPPLANE6 = false, t3.ALPHATEST = false, t3.DEPTHPREPASS = false, t3.POINTSIZE = false, t3.FOG = false, t3.NORMAL = false, t3.UV1 = false, t3.UV2 = false, t3.VERTEXCOLOR = false, t3.VERTEXALPHA = false, t3.NUM_BONE_INFLUENCERS = 0, t3.BonesPerMesh = 0, t3.INSTANCES = false, t3.SPECULARTERM = false, t3.LOGARITHMICDEPTH = false, t3.FRESNELSEPARATE = false, t3.BUMPSUPERIMPOSE = false, t3.BUMPAFFECTSREFLECTION = false, t3.IMAGEPROCESSING = false, t3.VIGNETTE = false, t3.VIGNETTEBLENDMODEMULTIPLY = false, t3.VIGNETTEBLENDMODEOPAQUE = false, t3.TONEMAPPING = false, t3.TONEMAPPING_ACES = false, t3.CONTRAST = false, t3.EXPOSURE = false, t3.COLORCURVES = false, t3.COLORGRADING = false, t3.COLORGRADING3D = false, t3.SAMPLER3DGREENDEPTH = false, t3.SAMPLER3DBGRMAP = false, t3.IMAGEPROCESSINGPOSTPROCESS = false, t3.rebuild(), t3;
          }
          return Object(n.b)(t2, e3), t2;
        }(r.MaterialDefines), f = function(e3) {
          function t2(t3, i2, n2) {
            n2 === void 0 && (n2 = new r.Vector2(512, 512));
            var o2 = e3.call(this, t3, i2) || this;
            return o2.renderTargetSize = n2, o2.diffuseColor = new r.Color3(1, 1, 1), o2.specularColor = new r.Color3(0, 0, 0), o2.specularPower = 64, o2._disableLighting = false, o2._maxSimultaneousLights = 4, o2.windForce = 6, o2.windDirection = new r.Vector2(0, 1), o2.waveHeight = 0.4, o2.bumpHeight = 0.4, o2._bumpSuperimpose = false, o2._fresnelSeparate = false, o2._bumpAffectsReflection = false, o2.waterColor = new r.Color3(0.1, 0.1, 0.6), o2.colorBlendFactor = 0.2, o2.waterColor2 = new r.Color3(0.1, 0.1, 0.6), o2.colorBlendFactor2 = 0.2, o2.waveLength = 0.1, o2.waveSpeed = 1, o2.waveCount = 20, o2.disableClipPlane = false, o2._renderTargets = new r.SmartArray(16), o2._mesh = null, o2._reflectionTransform = r.Matrix.Zero(), o2._lastTime = 0, o2._lastDeltaTime = 0, o2._createRenderTargets(i2, n2), o2.getRenderTargetTextures = function() {
              return o2._renderTargets.reset(), o2._renderTargets.push(o2._reflectionRTT), o2._renderTargets.push(o2._refractionRTT), o2._renderTargets;
            }, o2._imageProcessingConfiguration = o2.getScene().imageProcessingConfiguration, o2._imageProcessingConfiguration && (o2._imageProcessingObserver = o2._imageProcessingConfiguration.onUpdateParameters.add(function() {
              o2._markAllSubMeshesAsImageProcessingDirty();
            })), o2;
          }
          return Object(n.b)(t2, e3), Object.defineProperty(t2.prototype, "hasRenderTargetTextures", { get: function() {
            return true;
          }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "useLogarithmicDepth", { get: function() {
            return this._useLogarithmicDepth;
          }, set: function(e4) {
            this._useLogarithmicDepth = e4 && this.getScene().getEngine().getCaps().fragmentDepthSupported, this._markAllSubMeshesAsMiscDirty();
          }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "refractionTexture", { get: function() {
            return this._refractionRTT;
          }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "reflectionTexture", { get: function() {
            return this._reflectionRTT;
          }, enumerable: false, configurable: true }), t2.prototype.addToRenderList = function(e4) {
            this._refractionRTT && this._refractionRTT.renderList && this._refractionRTT.renderList.push(e4), this._reflectionRTT && this._reflectionRTT.renderList && this._reflectionRTT.renderList.push(e4);
          }, t2.prototype.enableRenderTargets = function(e4) {
            var t3 = e4 ? 1 : 0;
            this._refractionRTT && (this._refractionRTT.refreshRate = t3), this._reflectionRTT && (this._reflectionRTT.refreshRate = t3);
          }, t2.prototype.getRenderList = function() {
            return this._refractionRTT ? this._refractionRTT.renderList : [];
          }, Object.defineProperty(t2.prototype, "renderTargetsEnabled", { get: function() {
            return !(this._refractionRTT && this._refractionRTT.refreshRate === 0);
          }, enumerable: false, configurable: true }), t2.prototype.needAlphaBlending = function() {
            return this.alpha < 1;
          }, t2.prototype.needAlphaTesting = function() {
            return false;
          }, t2.prototype.getAlphaTestTexture = function() {
            return null;
          }, t2.prototype.isReadyForSubMesh = function(e4, t3, i2) {
            if (this.isFrozen && t3.effect && t3.effect._wasPreviouslyReady)
              return true;
            t3._materialDefines || (t3._materialDefines = new s());
            var n2 = t3._materialDefines, o2 = this.getScene();
            if (this._isReadyForSubMesh(t3))
              return true;
            var a2 = o2.getEngine();
            if (n2._areTexturesDirty && (n2._needUVs = false, o2.texturesEnabled)) {
              if (this.bumpTexture && r.MaterialFlags.BumpTextureEnabled) {
                if (!this.bumpTexture.isReady())
                  return false;
                n2._needUVs = true, n2.BUMP = true;
              }
              r.MaterialFlags.ReflectionTextureEnabled && (n2.REFLECTION = true);
            }
            if (r.MaterialHelper.PrepareDefinesForFrameBoundValues(o2, a2, n2, !!i2), r.MaterialHelper.PrepareDefinesForMisc(e4, o2, this._useLogarithmicDepth, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(e4), n2), n2._areMiscDirty && (this._fresnelSeparate && (n2.FRESNELSEPARATE = true), this._bumpSuperimpose && (n2.BUMPSUPERIMPOSE = true), this._bumpAffectsReflection && (n2.BUMPAFFECTSREFLECTION = true)), n2._needNormals = r.MaterialHelper.PrepareDefinesForLights(o2, e4, n2, true, this._maxSimultaneousLights, this._disableLighting), n2._areImageProcessingDirty && this._imageProcessingConfiguration) {
              if (!this._imageProcessingConfiguration.isReady())
                return false;
              this._imageProcessingConfiguration.prepareDefines(n2), n2.IS_REFLECTION_LINEAR = this.reflectionTexture != null && !this.reflectionTexture.gammaSpace, n2.IS_REFRACTION_LINEAR = this.refractionTexture != null && !this.refractionTexture.gammaSpace;
            }
            if (r.MaterialHelper.PrepareDefinesForAttributes(e4, n2, true, true), this._mesh = e4, this._waitingRenderList) {
              for (var f2 = 0; f2 < this._waitingRenderList.length; f2++)
                this.addToRenderList(o2.getNodeByID(this._waitingRenderList[f2]));
              this._waitingRenderList = null;
            }
            if (n2.isDirty) {
              n2.markAsProcessed(), o2.resetCachedMaterial();
              var l = new r.EffectFallbacks();
              n2.FOG && l.addFallback(1, "FOG"), n2.LOGARITHMICDEPTH && l.addFallback(0, "LOGARITHMICDEPTH"), r.MaterialHelper.HandleFallbacksForShadows(n2, l, this.maxSimultaneousLights), n2.NUM_BONE_INFLUENCERS > 0 && l.addCPUSkinningFallback(0, e4);
              var u = [r.VertexBuffer.PositionKind];
              n2.NORMAL && u.push(r.VertexBuffer.NormalKind), n2.UV1 && u.push(r.VertexBuffer.UVKind), n2.UV2 && u.push(r.VertexBuffer.UV2Kind), n2.VERTEXCOLOR && u.push(r.VertexBuffer.ColorKind), r.MaterialHelper.PrepareAttributesForBones(u, e4, n2, l), r.MaterialHelper.PrepareAttributesForInstances(u, n2);
              var c = n2.toString(), d = ["world", "view", "viewProjection", "vEyePosition", "vLightsType", "vDiffuseColor", "vSpecularColor", "vFogInfos", "vFogColor", "pointSize", "vNormalInfos", "mBones", "vClipPlane", "vClipPlane2", "vClipPlane3", "vClipPlane4", "vClipPlane5", "vClipPlane6", "normalMatrix", "logarithmicDepthConstant", "worldReflectionViewProjection", "windDirection", "waveLength", "time", "windForce", "cameraPosition", "bumpHeight", "waveHeight", "waterColor", "waterColor2", "colorBlendFactor", "colorBlendFactor2", "waveSpeed", "waveCount"], p = ["normalSampler", "refractionSampler", "reflectionSampler"], h = new Array();
              r.ImageProcessingConfiguration && (r.ImageProcessingConfiguration.PrepareUniforms(d, n2), r.ImageProcessingConfiguration.PrepareSamplers(p, n2)), r.MaterialHelper.PrepareUniformsAndSamplersList({ uniformsNames: d, uniformBuffersNames: h, samplers: p, defines: n2, maxSimultaneousLights: this.maxSimultaneousLights }), t3.setEffect(o2.getEngine().createEffect("water", { attributes: u, uniformsNames: d, uniformBuffersNames: h, samplers: p, defines: c, fallbacks: l, onCompiled: this.onCompiled, onError: this.onError, indexParameters: { maxSimultaneousLights: this._maxSimultaneousLights } }, a2), n2);
            }
            return !(!t3.effect || !t3.effect.isReady()) && (n2._renderId = o2.getRenderId(), t3.effect._wasPreviouslyReady = true, true);
          }, t2.prototype.bindForSubMesh = function(e4, t3, i2) {
            var n2 = this.getScene(), o2 = i2._materialDefines;
            if (o2) {
              var a2 = i2.effect;
              if (a2 && this._mesh) {
                this._activeEffect = a2, this.bindOnlyWorldMatrix(e4), this._activeEffect.setMatrix("viewProjection", n2.getTransformMatrix()), r.MaterialHelper.BindBonesParameters(t3, this._activeEffect), this._mustRebind(n2, a2) && (this.bumpTexture && r.MaterialFlags.BumpTextureEnabled && (this._activeEffect.setTexture("normalSampler", this.bumpTexture), this._activeEffect.setFloat2("vNormalInfos", this.bumpTexture.coordinatesIndex, this.bumpTexture.level), this._activeEffect.setMatrix("normalMatrix", this.bumpTexture.getTextureMatrix())), r.MaterialHelper.BindClipPlane(this._activeEffect, n2), this.pointsCloud && this._activeEffect.setFloat("pointSize", this.pointSize), r.MaterialHelper.BindEyePosition(a2, n2)), this._activeEffect.setColor4("vDiffuseColor", this.diffuseColor, this.alpha * t3.visibility), o2.SPECULARTERM && this._activeEffect.setColor4("vSpecularColor", this.specularColor, this.specularPower), n2.lightsEnabled && !this.disableLighting && r.MaterialHelper.BindLights(n2, t3, this._activeEffect, o2, this.maxSimultaneousLights), n2.fogEnabled && t3.applyFog && n2.fogMode !== r.Scene.FOGMODE_NONE && this._activeEffect.setMatrix("view", n2.getViewMatrix()), r.MaterialHelper.BindFogParameters(n2, t3, this._activeEffect), r.MaterialHelper.BindLogDepth(o2, this._activeEffect, n2), r.MaterialFlags.ReflectionTextureEnabled && (this._activeEffect.setTexture("refractionSampler", this._refractionRTT), this._activeEffect.setTexture("reflectionSampler", this._reflectionRTT));
                var s2 = this._mesh.getWorldMatrix().multiply(this._reflectionTransform).multiply(n2.getProjectionMatrix()), f2 = n2.getEngine().getDeltaTime();
                f2 !== this._lastDeltaTime && (this._lastDeltaTime = f2, this._lastTime += this._lastDeltaTime), this._activeEffect.setMatrix("worldReflectionViewProjection", s2), this._activeEffect.setVector2("windDirection", this.windDirection), this._activeEffect.setFloat("waveLength", this.waveLength), this._activeEffect.setFloat("time", this._lastTime / 1e5), this._activeEffect.setFloat("windForce", this.windForce), this._activeEffect.setFloat("waveHeight", this.waveHeight), this._activeEffect.setFloat("bumpHeight", this.bumpHeight), this._activeEffect.setColor4("waterColor", this.waterColor, 1), this._activeEffect.setFloat("colorBlendFactor", this.colorBlendFactor), this._activeEffect.setColor4("waterColor2", this.waterColor2, 1), this._activeEffect.setFloat("colorBlendFactor2", this.colorBlendFactor2), this._activeEffect.setFloat("waveSpeed", this.waveSpeed), this._activeEffect.setFloat("waveCount", this.waveCount), this._imageProcessingConfiguration && !this._imageProcessingConfiguration.applyByPostProcess && this._imageProcessingConfiguration.bind(this._activeEffect), this._afterBind(t3, this._activeEffect);
              }
            }
          }, t2.prototype._createRenderTargets = function(e4, t3) {
            var i2, n2 = this;
            this._refractionRTT = new r.RenderTargetTexture(name + "_refraction", { width: t3.x, height: t3.y }, e4, false, true), this._refractionRTT.wrapU = r.Constants.TEXTURE_MIRROR_ADDRESSMODE, this._refractionRTT.wrapV = r.Constants.TEXTURE_MIRROR_ADDRESSMODE, this._refractionRTT.ignoreCameraViewport = true, this._reflectionRTT = new r.RenderTargetTexture(name + "_reflection", { width: t3.x, height: t3.y }, e4, false, true), this._reflectionRTT.wrapU = r.Constants.TEXTURE_MIRROR_ADDRESSMODE, this._reflectionRTT.wrapV = r.Constants.TEXTURE_MIRROR_ADDRESSMODE, this._reflectionRTT.ignoreCameraViewport = true;
            var o2, a2 = null, s2 = r.Matrix.Zero();
            this._refractionRTT.onBeforeRender = function() {
              if (n2._mesh && (i2 = n2._mesh.isVisible, n2._mesh.isVisible = false), !n2.disableClipPlane) {
                a2 = e4.clipPlane;
                var t4 = n2._mesh ? n2._mesh.position.y : 0;
                e4.clipPlane = r.Plane.FromPositionAndNormal(new r.Vector3(0, t4 + 0.05, 0), new r.Vector3(0, 1, 0));
              }
            }, this._refractionRTT.onAfterRender = function() {
              n2._mesh && (n2._mesh.isVisible = i2), n2.disableClipPlane || (e4.clipPlane = a2);
            }, this._reflectionRTT.onBeforeRender = function() {
              if (n2._mesh && (i2 = n2._mesh.isVisible, n2._mesh.isVisible = false), !n2.disableClipPlane) {
                a2 = e4.clipPlane;
                var t4 = n2._mesh ? n2._mesh.position.y : 0;
                e4.clipPlane = r.Plane.FromPositionAndNormal(new r.Vector3(0, t4 - 0.05, 0), new r.Vector3(0, -1, 0)), r.Matrix.ReflectionToRef(e4.clipPlane, s2);
              }
              o2 = e4.getViewMatrix(), s2.multiplyToRef(o2, n2._reflectionTransform), e4.setTransformMatrix(n2._reflectionTransform, e4.getProjectionMatrix()), e4.getEngine().cullBackFaces = false, e4._mirroredCameraPosition = r.Vector3.TransformCoordinates(e4.activeCamera.position, s2);
            }, this._reflectionRTT.onAfterRender = function() {
              n2._mesh && (n2._mesh.isVisible = i2), e4.clipPlane = a2, e4.setTransformMatrix(o2, e4.getProjectionMatrix()), e4.getEngine().cullBackFaces = true, e4._mirroredCameraPosition = null;
            };
          }, t2.prototype.getAnimatables = function() {
            var e4 = [];
            return this.bumpTexture && this.bumpTexture.animations && this.bumpTexture.animations.length > 0 && e4.push(this.bumpTexture), this._reflectionRTT && this._reflectionRTT.animations && this._reflectionRTT.animations.length > 0 && e4.push(this._reflectionRTT), this._refractionRTT && this._refractionRTT.animations && this._refractionRTT.animations.length > 0 && e4.push(this._refractionRTT), e4;
          }, t2.prototype.getActiveTextures = function() {
            var t3 = e3.prototype.getActiveTextures.call(this);
            return this._bumpTexture && t3.push(this._bumpTexture), t3;
          }, t2.prototype.hasTexture = function(t3) {
            return !!e3.prototype.hasTexture.call(this, t3) || this._bumpTexture === t3;
          }, t2.prototype.dispose = function(t3) {
            this.bumpTexture && this.bumpTexture.dispose();
            var i2 = this.getScene().customRenderTargets.indexOf(this._refractionRTT);
            i2 != -1 && this.getScene().customRenderTargets.splice(i2, 1), i2 = -1, (i2 = this.getScene().customRenderTargets.indexOf(this._reflectionRTT)) != -1 && this.getScene().customRenderTargets.splice(i2, 1), this._reflectionRTT && this._reflectionRTT.dispose(), this._refractionRTT && this._refractionRTT.dispose(), this._imageProcessingConfiguration && this._imageProcessingObserver && this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver), e3.prototype.dispose.call(this, t3);
          }, t2.prototype.clone = function(e4) {
            var i2 = this;
            return r.SerializationHelper.Clone(function() {
              return new t2(e4, i2.getScene());
            }, this);
          }, t2.prototype.serialize = function() {
            var e4 = r.SerializationHelper.Serialize(this);
            if (e4.customType = "BABYLON.WaterMaterial", e4.renderList = [], this._refractionRTT && this._refractionRTT.renderList)
              for (var t3 = 0; t3 < this._refractionRTT.renderList.length; t3++)
                e4.renderList.push(this._refractionRTT.renderList[t3].id);
            return e4;
          }, t2.prototype.getClassName = function() {
            return "WaterMaterial";
          }, t2.Parse = function(e4, i2, n2) {
            var o2 = r.SerializationHelper.Parse(function() {
              return new t2(e4.name, i2);
            }, e4, i2, n2);
            return o2._waitingRenderList = e4.renderList, o2;
          }, t2.CreateDefaultMesh = function(e4, t3) {
            return r.Mesh.CreateGround(e4, 512, 512, 32, t3, false);
          }, Object(n.a)([Object(r.serializeAsTexture)("bumpTexture")], t2.prototype, "_bumpTexture", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsTexturesDirty")], t2.prototype, "bumpTexture", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "diffuseColor", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "specularColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "specularPower", void 0), Object(n.a)([Object(r.serialize)("disableLighting")], t2.prototype, "_disableLighting", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "disableLighting", void 0), Object(n.a)([Object(r.serialize)("maxSimultaneousLights")], t2.prototype, "_maxSimultaneousLights", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsLightsDirty")], t2.prototype, "maxSimultaneousLights", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "windForce", void 0), Object(n.a)([Object(r.serializeAsVector2)()], t2.prototype, "windDirection", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "waveHeight", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "bumpHeight", void 0), Object(n.a)([Object(r.serialize)("bumpSuperimpose")], t2.prototype, "_bumpSuperimpose", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsMiscDirty")], t2.prototype, "bumpSuperimpose", void 0), Object(n.a)([Object(r.serialize)("fresnelSeparate")], t2.prototype, "_fresnelSeparate", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsMiscDirty")], t2.prototype, "fresnelSeparate", void 0), Object(n.a)([Object(r.serialize)("bumpAffectsReflection")], t2.prototype, "_bumpAffectsReflection", void 0), Object(n.a)([Object(r.expandToProperty)("_markAllSubMeshesAsMiscDirty")], t2.prototype, "bumpAffectsReflection", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "waterColor", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "colorBlendFactor", void 0), Object(n.a)([Object(r.serializeAsColor3)()], t2.prototype, "waterColor2", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "colorBlendFactor2", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "waveLength", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "waveSpeed", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "waveCount", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "disableClipPlane", void 0), Object(n.a)([Object(r.serialize)()], t2.prototype, "useLogarithmicDepth", null), t2;
        }(r.PushMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.WaterMaterial"] = f;
      }, function(e2, t, i) {
        "use strict";
        i.r(t), i.d(t, "CustomShaderStructure", function() {
          return o;
        }), i.d(t, "ShaderSpecialParts", function() {
          return a;
        }), i.d(t, "CustomMaterial", function() {
          return s;
        }), i.d(t, "ShaderAlebdoParts", function() {
          return f;
        }), i.d(t, "PBRCustomMaterial", function() {
          return l;
        });
        var n = i(1), r = i(0), o = function() {
        }, a = function() {
        }, s = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.CustomParts = new a(), n2.customShaderNameResolve = n2.Builder, n2.FragmentShader = r.Effect.ShadersStore.defaultPixelShader, n2.VertexShader = r.Effect.ShadersStore.defaultVertexShader, n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.AttachAfterBind = function(e4, t3) {
            if (this._newUniformInstances)
              for (var i2 in this._newUniformInstances) {
                (n2 = i2.toString().split("-"))[0] == "vec2" ? t3.setVector2(n2[1], this._newUniformInstances[i2]) : n2[0] == "vec3" ? t3.setVector3(n2[1], this._newUniformInstances[i2]) : n2[0] == "vec4" ? t3.setVector4(n2[1], this._newUniformInstances[i2]) : n2[0] == "mat4" ? t3.setMatrix(n2[1], this._newUniformInstances[i2]) : n2[0] == "float" && t3.setFloat(n2[1], this._newUniformInstances[i2]);
              }
            if (this._newSamplerInstances)
              for (var i2 in this._newSamplerInstances) {
                var n2;
                (n2 = i2.toString().split("-"))[0] == "sampler2D" && this._newSamplerInstances[i2].isReady && this._newSamplerInstances[i2].isReady() && t3.setTexture(n2[1], this._newSamplerInstances[i2]);
              }
          }, t2.prototype.ReviewUniform = function(e4, t3) {
            if (e4 == "uniform" && this._newUniforms)
              for (var i2 = 0; i2 < this._newUniforms.length; i2++)
                this._customUniform[i2].indexOf("sampler") == -1 && t3.push(this._newUniforms[i2]);
            if (e4 == "sampler" && this._newUniforms)
              for (i2 = 0; i2 < this._newUniforms.length; i2++)
                this._customUniform[i2].indexOf("sampler") != -1 && t3.push(this._newUniforms[i2]);
            return t3;
          }, t2.prototype.Builder = function(e4, i2, n2, o2, a2, s2) {
            var f2 = this;
            if (s2 && this._customAttributes && this._customAttributes.length > 0 && s2.push.apply(s2, this._customAttributes), this.ReviewUniform("uniform", i2), this.ReviewUniform("sampler", o2), this._isCreatedShader)
              return this._createdShaderName;
            this._isCreatedShader = false, t2.ShaderIndexer++;
            var l2 = "custom_" + t2.ShaderIndexer, u = this._afterBind.bind(this);
            return this._afterBind = function(e5, t3) {
              if (t3) {
                f2.AttachAfterBind(e5, t3);
                try {
                  u(e5, t3);
                } catch (t4) {
                }
              }
            }, r.Effect.ShadersStore[l2 + "VertexShader"] = this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN", this.CustomParts.Vertex_Begin ? this.CustomParts.Vertex_Begin : "").replace("#define CUSTOM_VERTEX_DEFINITIONS", (this._customUniform ? this._customUniform.join("\n") : "") + (this.CustomParts.Vertex_Definitions ? this.CustomParts.Vertex_Definitions : "")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN", this.CustomParts.Vertex_MainBegin ? this.CustomParts.Vertex_MainBegin : "").replace("#define CUSTOM_VERTEX_UPDATE_POSITION", this.CustomParts.Vertex_Before_PositionUpdated ? this.CustomParts.Vertex_Before_PositionUpdated : "").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL", this.CustomParts.Vertex_Before_NormalUpdated ? this.CustomParts.Vertex_Before_NormalUpdated : "").replace("#define CUSTOM_VERTEX_MAIN_END", this.CustomParts.Vertex_MainEnd ? this.CustomParts.Vertex_MainEnd : ""), this.CustomParts.Vertex_After_WorldPosComputed && (r.Effect.ShadersStore[l2 + "VertexShader"] = r.Effect.ShadersStore[l2 + "VertexShader"].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS", this.CustomParts.Vertex_After_WorldPosComputed)), r.Effect.ShadersStore[l2 + "PixelShader"] = this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN", this.CustomParts.Fragment_Begin ? this.CustomParts.Fragment_Begin : "").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN", this.CustomParts.Fragment_MainBegin ? this.CustomParts.Fragment_MainBegin : "").replace("#define CUSTOM_FRAGMENT_DEFINITIONS", (this._customUniform ? this._customUniform.join("\n") : "") + (this.CustomParts.Fragment_Definitions ? this.CustomParts.Fragment_Definitions : "")).replace("#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE", this.CustomParts.Fragment_Custom_Diffuse ? this.CustomParts.Fragment_Custom_Diffuse : "").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA", this.CustomParts.Fragment_Custom_Alpha ? this.CustomParts.Fragment_Custom_Alpha : "").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS", this.CustomParts.Fragment_Before_Lights ? this.CustomParts.Fragment_Before_Lights : "").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR", this.CustomParts.Fragment_Before_FragColor ? this.CustomParts.Fragment_Before_FragColor : ""), this.CustomParts.Fragment_Before_Fog && (r.Effect.ShadersStore[l2 + "PixelShader"] = r.Effect.ShadersStore[l2 + "PixelShader"].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG", this.CustomParts.Fragment_Before_Fog)), this._isCreatedShader = true, this._createdShaderName = l2, l2;
          }, t2.prototype.AddUniform = function(e4, t3, i2) {
            return this._customUniform || (this._customUniform = new Array(), this._newUniforms = new Array(), this._newSamplerInstances = {}, this._newUniformInstances = {}), i2 && (t3.indexOf("sampler") != -1 ? this._newSamplerInstances[t3 + "-" + e4] = i2 : this._newUniformInstances[t3 + "-" + e4] = i2), this._customUniform.push("uniform " + t3 + " " + e4 + ";"), this._newUniforms.push(e4), this;
          }, t2.prototype.AddAttribute = function(e4) {
            return this._customAttributes || (this._customAttributes = []), this._customAttributes.push(e4), this;
          }, t2.prototype.Fragment_Begin = function(e4) {
            return this.CustomParts.Fragment_Begin = e4, this;
          }, t2.prototype.Fragment_Definitions = function(e4) {
            return this.CustomParts.Fragment_Definitions = e4, this;
          }, t2.prototype.Fragment_MainBegin = function(e4) {
            return this.CustomParts.Fragment_MainBegin = e4, this;
          }, t2.prototype.Fragment_Custom_Diffuse = function(e4) {
            return this.CustomParts.Fragment_Custom_Diffuse = e4.replace("result", "diffuseColor"), this;
          }, t2.prototype.Fragment_Custom_Alpha = function(e4) {
            return this.CustomParts.Fragment_Custom_Alpha = e4.replace("result", "alpha"), this;
          }, t2.prototype.Fragment_Before_Lights = function(e4) {
            return this.CustomParts.Fragment_Before_Lights = e4, this;
          }, t2.prototype.Fragment_Before_Fog = function(e4) {
            return this.CustomParts.Fragment_Before_Fog = e4, this;
          }, t2.prototype.Fragment_Before_FragColor = function(e4) {
            return this.CustomParts.Fragment_Before_FragColor = e4.replace("result", "color"), this;
          }, t2.prototype.Vertex_Begin = function(e4) {
            return this.CustomParts.Vertex_Begin = e4, this;
          }, t2.prototype.Vertex_Definitions = function(e4) {
            return this.CustomParts.Vertex_Definitions = e4, this;
          }, t2.prototype.Vertex_MainBegin = function(e4) {
            return this.CustomParts.Vertex_MainBegin = e4, this;
          }, t2.prototype.Vertex_Before_PositionUpdated = function(e4) {
            return this.CustomParts.Vertex_Before_PositionUpdated = e4.replace("result", "positionUpdated"), this;
          }, t2.prototype.Vertex_Before_NormalUpdated = function(e4) {
            return this.CustomParts.Vertex_Before_NormalUpdated = e4.replace("result", "normalUpdated"), this;
          }, t2.prototype.Vertex_After_WorldPosComputed = function(e4) {
            return this.CustomParts.Vertex_After_WorldPosComputed = e4, this;
          }, t2.prototype.Vertex_MainEnd = function(e4) {
            return this.CustomParts.Vertex_MainEnd = e4, this;
          }, t2.ShaderIndexer = 1, t2;
        }(r.StandardMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.CustomMaterial"] = s;
        var f = function() {
        }, l = function(e3) {
          function t2(t3, i2) {
            var n2 = e3.call(this, t3, i2) || this;
            return n2.CustomParts = new f(), n2.customShaderNameResolve = n2.Builder, n2.FragmentShader = r.Effect.ShadersStore.pbrPixelShader, n2.VertexShader = r.Effect.ShadersStore.pbrVertexShader, n2.FragmentShader = n2.FragmentShader.replace(/#include<pbrBlockAlbedoOpacity>/g, r.Effect.IncludesShadersStore.pbrBlockAlbedoOpacity), n2.FragmentShader = n2.FragmentShader.replace(/#include<pbrBlockReflectivity>/g, r.Effect.IncludesShadersStore.pbrBlockReflectivity), n2.FragmentShader = n2.FragmentShader.replace(/#include<pbrBlockFinalColorComposition>/g, r.Effect.IncludesShadersStore.pbrBlockFinalColorComposition), n2;
          }
          return Object(n.b)(t2, e3), t2.prototype.AttachAfterBind = function(e4, t3) {
            if (this._newUniformInstances)
              for (var i2 in this._newUniformInstances) {
                (n2 = i2.toString().split("-"))[0] == "vec2" ? t3.setVector2(n2[1], this._newUniformInstances[i2]) : n2[0] == "vec3" ? t3.setVector3(n2[1], this._newUniformInstances[i2]) : n2[0] == "vec4" ? t3.setVector4(n2[1], this._newUniformInstances[i2]) : n2[0] == "mat4" ? t3.setMatrix(n2[1], this._newUniformInstances[i2]) : n2[0] == "float" && t3.setFloat(n2[1], this._newUniformInstances[i2]);
              }
            if (this._newSamplerInstances)
              for (var i2 in this._newSamplerInstances) {
                var n2;
                (n2 = i2.toString().split("-"))[0] == "sampler2D" && this._newSamplerInstances[i2].isReady && this._newSamplerInstances[i2].isReady() && t3.setTexture(n2[1], this._newSamplerInstances[i2]);
              }
          }, t2.prototype.ReviewUniform = function(e4, t3) {
            if (e4 == "uniform" && this._newUniforms)
              for (var i2 = 0; i2 < this._newUniforms.length; i2++)
                this._customUniform[i2].indexOf("sampler") == -1 && t3.push(this._newUniforms[i2]);
            if (e4 == "sampler" && this._newUniforms)
              for (i2 = 0; i2 < this._newUniforms.length; i2++)
                this._customUniform[i2].indexOf("sampler") != -1 && t3.push(this._newUniforms[i2]);
            return t3;
          }, t2.prototype.Builder = function(e4, i2, n2, o2, a2, s2) {
            var f2 = this;
            if (s2 && this._customAttributes && this._customAttributes.length > 0 && s2.push.apply(s2, this._customAttributes), this.ReviewUniform("uniform", i2), this.ReviewUniform("sampler", o2), this._isCreatedShader)
              return this._createdShaderName;
            this._isCreatedShader = false, t2.ShaderIndexer++;
            var l2 = "custom_" + t2.ShaderIndexer, u = this._afterBind.bind(this);
            return this._afterBind = function(e5, t3) {
              if (t3) {
                f2.AttachAfterBind(e5, t3);
                try {
                  u(e5, t3);
                } catch (t4) {
                }
              }
            }, r.Effect.ShadersStore[l2 + "VertexShader"] = this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN", this.CustomParts.Vertex_Begin ? this.CustomParts.Vertex_Begin : "").replace("#define CUSTOM_VERTEX_DEFINITIONS", (this._customUniform ? this._customUniform.join("\n") : "") + (this.CustomParts.Vertex_Definitions ? this.CustomParts.Vertex_Definitions : "")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN", this.CustomParts.Vertex_MainBegin ? this.CustomParts.Vertex_MainBegin : "").replace("#define CUSTOM_VERTEX_UPDATE_POSITION", this.CustomParts.Vertex_Before_PositionUpdated ? this.CustomParts.Vertex_Before_PositionUpdated : "").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL", this.CustomParts.Vertex_Before_NormalUpdated ? this.CustomParts.Vertex_Before_NormalUpdated : "").replace("#define CUSTOM_VERTEX_MAIN_END", this.CustomParts.Vertex_MainEnd ? this.CustomParts.Vertex_MainEnd : ""), this.CustomParts.Vertex_After_WorldPosComputed && (r.Effect.ShadersStore[l2 + "VertexShader"] = r.Effect.ShadersStore[l2 + "VertexShader"].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS", this.CustomParts.Vertex_After_WorldPosComputed)), r.Effect.ShadersStore[l2 + "PixelShader"] = this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN", this.CustomParts.Fragment_Begin ? this.CustomParts.Fragment_Begin : "").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN", this.CustomParts.Fragment_MainBegin ? this.CustomParts.Fragment_MainBegin : "").replace("#define CUSTOM_FRAGMENT_DEFINITIONS", (this._customUniform ? this._customUniform.join("\n") : "") + (this.CustomParts.Fragment_Definitions ? this.CustomParts.Fragment_Definitions : "")).replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO", this.CustomParts.Fragment_Custom_Albedo ? this.CustomParts.Fragment_Custom_Albedo : "").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA", this.CustomParts.Fragment_Custom_Alpha ? this.CustomParts.Fragment_Custom_Alpha : "").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS", this.CustomParts.Fragment_Before_Lights ? this.CustomParts.Fragment_Before_Lights : "").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS", this.CustomParts.Fragment_Custom_MetallicRoughness ? this.CustomParts.Fragment_Custom_MetallicRoughness : "").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE", this.CustomParts.Fragment_Custom_MicroSurface ? this.CustomParts.Fragment_Custom_MicroSurface : "").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR", this.CustomParts.Fragment_Before_FragColor ? this.CustomParts.Fragment_Before_FragColor : ""), this.CustomParts.Fragment_Before_Fog && (r.Effect.ShadersStore[l2 + "PixelShader"] = r.Effect.ShadersStore[l2 + "PixelShader"].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG", this.CustomParts.Fragment_Before_Fog)), this._isCreatedShader = true, this._createdShaderName = l2, l2;
          }, t2.prototype.AddUniform = function(e4, t3, i2) {
            return this._customUniform || (this._customUniform = new Array(), this._newUniforms = new Array(), this._newSamplerInstances = {}, this._newUniformInstances = {}), i2 && (t3.indexOf("sampler") != -1 ? this._newSamplerInstances[t3 + "-" + e4] = i2 : this._newUniformInstances[t3 + "-" + e4] = i2), this._customUniform.push("uniform " + t3 + " " + e4 + ";"), this._newUniforms.push(e4), this;
          }, t2.prototype.AddAttribute = function(e4) {
            return this._customAttributes || (this._customAttributes = []), this._customAttributes.push(e4), this;
          }, t2.prototype.Fragment_Begin = function(e4) {
            return this.CustomParts.Fragment_Begin = e4, this;
          }, t2.prototype.Fragment_Definitions = function(e4) {
            return this.CustomParts.Fragment_Definitions = e4, this;
          }, t2.prototype.Fragment_MainBegin = function(e4) {
            return this.CustomParts.Fragment_MainBegin = e4, this;
          }, t2.prototype.Fragment_Custom_Albedo = function(e4) {
            return this.CustomParts.Fragment_Custom_Albedo = e4.replace("result", "surfaceAlbedo"), this;
          }, t2.prototype.Fragment_Custom_Alpha = function(e4) {
            return this.CustomParts.Fragment_Custom_Alpha = e4.replace("result", "alpha"), this;
          }, t2.prototype.Fragment_Before_Lights = function(e4) {
            return this.CustomParts.Fragment_Before_Lights = e4, this;
          }, t2.prototype.Fragment_Custom_MetallicRoughness = function(e4) {
            return this.CustomParts.Fragment_Custom_MetallicRoughness = e4, this;
          }, t2.prototype.Fragment_Custom_MicroSurface = function(e4) {
            return this.CustomParts.Fragment_Custom_MicroSurface = e4, this;
          }, t2.prototype.Fragment_Before_Fog = function(e4) {
            return this.CustomParts.Fragment_Before_Fog = e4, this;
          }, t2.prototype.Fragment_Before_FragColor = function(e4) {
            return this.CustomParts.Fragment_Before_FragColor = e4.replace("result", "color"), this;
          }, t2.prototype.Vertex_Begin = function(e4) {
            return this.CustomParts.Vertex_Begin = e4, this;
          }, t2.prototype.Vertex_Definitions = function(e4) {
            return this.CustomParts.Vertex_Definitions = e4, this;
          }, t2.prototype.Vertex_MainBegin = function(e4) {
            return this.CustomParts.Vertex_MainBegin = e4, this;
          }, t2.prototype.Vertex_Before_PositionUpdated = function(e4) {
            return this.CustomParts.Vertex_Before_PositionUpdated = e4.replace("result", "positionUpdated"), this;
          }, t2.prototype.Vertex_Before_NormalUpdated = function(e4) {
            return this.CustomParts.Vertex_Before_NormalUpdated = e4.replace("result", "normalUpdated"), this;
          }, t2.prototype.Vertex_After_WorldPosComputed = function(e4) {
            return this.CustomParts.Vertex_After_WorldPosComputed = e4, this;
          }, t2.prototype.Vertex_MainEnd = function(e4) {
            return this.CustomParts.Vertex_MainEnd = e4, this;
          }, t2.ShaderIndexer = 1, t2;
        }(r.PBRMaterial);
        r._TypeStore.RegisteredTypes["BABYLON.PBRCustomMaterial"] = l;
      }, function(e2, t, i) {
        "use strict";
        i.r(t);
        var n = i(3);
        i.d(t, "CellMaterial", function() {
          return n.CellMaterial;
        });
        var r = i(17);
        i.d(t, "CustomShaderStructure", function() {
          return r.CustomShaderStructure;
        }), i.d(t, "ShaderSpecialParts", function() {
          return r.ShaderSpecialParts;
        }), i.d(t, "CustomMaterial", function() {
          return r.CustomMaterial;
        }), i.d(t, "ShaderAlebdoParts", function() {
          return r.ShaderAlebdoParts;
        }), i.d(t, "PBRCustomMaterial", function() {
          return r.PBRCustomMaterial;
        });
        var o = i(4);
        i.d(t, "FireMaterial", function() {
          return o.FireMaterial;
        });
        var a = i(5);
        i.d(t, "FurMaterial", function() {
          return a.FurMaterial;
        });
        var s = i(6);
        i.d(t, "GradientMaterial", function() {
          return s.GradientMaterial;
        });
        var f = i(7);
        i.d(t, "GridMaterial", function() {
          return f.GridMaterial;
        });
        var l = i(8);
        i.d(t, "LavaMaterial", function() {
          return l.LavaMaterial;
        });
        var u = i(9);
        i.d(t, "MixMaterial", function() {
          return u.MixMaterial;
        });
        var c = i(10);
        i.d(t, "NormalMaterial", function() {
          return c.NormalMaterial;
        });
        var d = i(11);
        i.d(t, "ShadowOnlyMaterial", function() {
          return d.ShadowOnlyMaterial;
        });
        var p = i(12);
        i.d(t, "SimpleMaterial", function() {
          return p.SimpleMaterial;
        });
        var h = i(13);
        i.d(t, "SkyMaterial", function() {
          return h.SkyMaterial;
        });
        var v = i(14);
        i.d(t, "TerrainMaterial", function() {
          return v.TerrainMaterial;
        });
        var m = i(15);
        i.d(t, "TriPlanarMaterial", function() {
          return m.TriPlanarMaterial;
        });
        var g = i(16);
        i.d(t, "WaterMaterial", function() {
          return g.WaterMaterial;
        });
      }, function(e2, t, i) {
        "use strict";
        i.r(t), function(e3) {
          var n = i(18);
          i.d(t, "CellMaterial", function() {
            return n.CellMaterial;
          }), i.d(t, "CustomShaderStructure", function() {
            return n.CustomShaderStructure;
          }), i.d(t, "ShaderSpecialParts", function() {
            return n.ShaderSpecialParts;
          }), i.d(t, "CustomMaterial", function() {
            return n.CustomMaterial;
          }), i.d(t, "ShaderAlebdoParts", function() {
            return n.ShaderAlebdoParts;
          }), i.d(t, "PBRCustomMaterial", function() {
            return n.PBRCustomMaterial;
          }), i.d(t, "FireMaterial", function() {
            return n.FireMaterial;
          }), i.d(t, "FurMaterial", function() {
            return n.FurMaterial;
          }), i.d(t, "GradientMaterial", function() {
            return n.GradientMaterial;
          }), i.d(t, "GridMaterial", function() {
            return n.GridMaterial;
          }), i.d(t, "LavaMaterial", function() {
            return n.LavaMaterial;
          }), i.d(t, "MixMaterial", function() {
            return n.MixMaterial;
          }), i.d(t, "NormalMaterial", function() {
            return n.NormalMaterial;
          }), i.d(t, "ShadowOnlyMaterial", function() {
            return n.ShadowOnlyMaterial;
          }), i.d(t, "SimpleMaterial", function() {
            return n.SimpleMaterial;
          }), i.d(t, "SkyMaterial", function() {
            return n.SkyMaterial;
          }), i.d(t, "TerrainMaterial", function() {
            return n.TerrainMaterial;
          }), i.d(t, "TriPlanarMaterial", function() {
            return n.TriPlanarMaterial;
          }), i.d(t, "WaterMaterial", function() {
            return n.WaterMaterial;
          });
          var r = e3 !== void 0 ? e3 : typeof window != "undefined" ? window : void 0;
          if (r !== void 0)
            for (var o in r.BABYLON = r.BABYLON || {}, n)
              r.BABYLON[o] = n[o];
        }.call(this, i(2));
      }]);
    });
  }
});

// dep:babylonjs-materials
var babylonjs_materials_default = require_babylonjs_materials_min();
export {
  babylonjs_materials_default as default
};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
//# sourceMappingURL=babylonjs-materials.js.map
